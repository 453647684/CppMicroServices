---
layout: default
title: Example 2b - Alternative Dictionary Service Module
---
  <head>
    <title>C++ Micro Services: Example 2b - Alternative Dictionary Service Module</title>
    <link href="tabs.css" rel="stylesheet" type="text/css"/>
    <script type="text/javascript" src="jquery.js"></script>
    <script type="text/javascript" src="dynsections.js"></script>
    <link href="search/search.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="search/search.js"></script>
<script type="text/javascript">
  $(document).ready(function() { searchBox.OnSelectItem(0); });
</script>
    <link href="doxygen.css" rel="stylesheet" type="text/css" />
    <link href="doxygen_extra.css" rel="stylesheet" type="text/css"/>
  </head>
  <div id="top"><!-- do not remove this div, it is closed by doxygen! -->
<!-- Generated by Doxygen 1.8.5 -->
<script type="text/javascript">
var searchBox = new SearchBox("searchBox", "search",false,'Search');
</script>
  <div id="navrow1" class="tabs">
    <ul class="tablist">
      <li><a href="index.html"><span>Main&#160;Page</span></a></li>
      <li class="current"><a href="pages.html"><span>Related&#160;Pages</span></a></li>
      <li><a href="modules.html"><span>Modules</span></a></li>
      <li><a href="namespaces.html"><span>Namespaces</span></a></li>
      <li><a href="annotated.html"><span>Classes</span></a></li>
      <li>
        <div id="MSearchBox" class="MSearchBoxInactive">
        <span class="left">
          <img id="MSearchSelect" src="search/mag_sel.png"
               onmouseover="return searchBox.OnSearchSelectShow()"
               onmouseout="return searchBox.OnSearchSelectHide()"
               alt=""/>
          <input type="text" id="MSearchField" value="Search" accesskey="S"
               onfocus="searchBox.OnSearchFieldFocus(true)" 
               onblur="searchBox.OnSearchFieldFocus(false)" 
               onkeyup="searchBox.OnSearchFieldChange(event)"/>
          </span><span class="right">
            <a id="MSearchClose" href="javascript:searchBox.CloseResultsWindow()"><img id="MSearchCloseImg" border="0" src="search/close.png" alt=""/></a>
          </span>
        </div>
      </li>
    </ul>
  </div>
<!-- window showing the filter options -->
<div id="MSearchSelectWindow"
     onmouseover="return searchBox.OnSearchSelectShow()"
     onmouseout="return searchBox.OnSearchSelectHide()"
     onkeydown="return searchBox.OnSearchSelectKey(event)">
<a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(0)"><span class="SelectionMark">&#160;</span>All</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(1)"><span class="SelectionMark">&#160;</span>Classes</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(2)"><span class="SelectionMark">&#160;</span>Namespaces</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(3)"><span class="SelectionMark">&#160;</span>Functions</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(4)"><span class="SelectionMark">&#160;</span>Variables</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(5)"><span class="SelectionMark">&#160;</span>Typedefs</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(6)"><span class="SelectionMark">&#160;</span>Enumerations</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(7)"><span class="SelectionMark">&#160;</span>Enumerator</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(8)"><span class="SelectionMark">&#160;</span>Friends</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(9)"><span class="SelectionMark">&#160;</span>Groups</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(10)"><span class="SelectionMark">&#160;</span>Pages</a></div>

<!-- iframe showing the search results (closed by default) -->
<div id="MSearchResultsWindow">
<iframe src="javascript:void(0)" frameborder="0" 
        name="MSearchResults" id="MSearchResults">
</iframe>
</div>

<div id="nav-path" class="navpath">
  <ul>
<li class="navelem"><a class="el" href="MicroServices_Tutorials.html">Tutorial</a></li>  </ul>
</div>
</div><!-- top -->
<div class="header">
  <div class="headertitle">
<div class="title">Example 2b - Alternative Dictionary Service <a class="el" href="classModule.html" title="Represents a CppMicroServices module. ">Module</a> </div>  </div>
</div><!--header-->
<div class="contents">
<div class="textblock"><p>This example creates an alternative implementation of the dictionary service defined in <a class="el" href="MicroServices_Example2.html">Example 2</a>. The source code for the module is identical except that instead of using English words, French words are used. The only other difference is that in this module we do not need to define the dictionary service interface again, since we can just link the definition from the module in Example 2. The main point of this example is to illustrate that multiple implementations of the same service may exist; this example will also be of use to us in <a class="el" href="MicroServices_Example5.html">Example 5</a>.</p>
<p>In the following source code, the module uses its module context to register the dictionary service. We implement the dictionary service as an inner class of the module activator class, but we could have also put it in a separate file. The source code for our module is as follows in a file called <code>dictionaryclient/Activator.cpp</code>:</p>
<div class="fragment"><div class="line"><span class="preprocessor">#include &quot;IDictionaryService.h&quot;</span></div>
<div class="line"></div>
<div class="line"><span class="preprocessor">#include &lt;usModuleActivator.h&gt;</span></div>
<div class="line"><span class="preprocessor">#include &lt;usModuleContext.h&gt;</span></div>
<div class="line"><span class="preprocessor">#include &lt;usGetModuleContext.h&gt;</span></div>
<div class="line"><span class="preprocessor">#include &lt;usServiceProperties.h&gt;</span></div>
<div class="line"></div>
<div class="line"><span class="preprocessor">#include &lt;set&gt;</span></div>
<div class="line"><span class="preprocessor">#include &lt;algorithm&gt;</span></div>
<div class="line"><span class="preprocessor">#include &lt;memory&gt;</span></div>
<div class="line"></div>
<div class="line">US_USE_NAMESPACE</div>
<div class="line"><span class="comment"></span></div>
<div class="line"><span class="comment">/**</span></div>
<div class="line"><span class="comment"> * This class implements a module activator that uses the module</span></div>
<div class="line"><span class="comment"> * context to register a French language dictionary service</span></div>
<div class="line"><span class="comment"> * with the C++ Micro Services registry during static initialization</span></div>
<div class="line"><span class="comment"> * of the module. The dictionary service interface is</span></div>
<div class="line"><span class="comment"> * defined in Example 2 (dictionaryservice) and is implemented by a</span></div>
<div class="line"><span class="comment"> * nested class. This class is identical to the class in Example 2,</span></div>
<div class="line"><span class="comment"> * except that the dictionary contains French words.</span></div>
<div class="line"><span class="comment"> */</span></div>
<div class="line"><span class="keyword">class </span>US_ABI_LOCAL Activator : <span class="keyword">public</span> <a class="code" href="structModuleActivator.html">ModuleActivator</a></div>
<div class="line">{</div>
<div class="line"></div>
<div class="line"><span class="keyword">private</span>:</div>
<div class="line"><span class="comment"></span></div>
<div class="line"><span class="comment">  /**</span></div>
<div class="line"><span class="comment">   * A private inner class that implements a dictionary service;</span></div>
<div class="line"><span class="comment">   * see DictionaryService for details of the service.</span></div>
<div class="line"><span class="comment">   */</span></div>
<div class="line">  <span class="keyword">class </span>DictionaryImpl : <span class="keyword">public</span> IDictionaryService</div>
<div class="line">  {</div>
<div class="line">    <span class="comment">// The set of words contained in the dictionary.</span></div>
<div class="line">    std::set&lt;std::string&gt; m_dictionary;</div>
<div class="line"></div>
<div class="line">  <span class="keyword">public</span>:</div>
<div class="line"></div>
<div class="line">    DictionaryImpl()</div>
<div class="line">    {</div>
<div class="line">      m_dictionary.insert(<span class="stringliteral">&quot;bienvenue&quot;</span>);</div>
<div class="line">      m_dictionary.insert(<span class="stringliteral">&quot;au&quot;</span>);</div>
<div class="line">      m_dictionary.insert(<span class="stringliteral">&quot;tutoriel&quot;</span>);</div>
<div class="line">      m_dictionary.insert(<span class="stringliteral">&quot;micro&quot;</span>);</div>
<div class="line">      m_dictionary.insert(<span class="stringliteral">&quot;services&quot;</span>);</div>
<div class="line">    }</div>
<div class="line"><span class="comment"></span></div>
<div class="line"><span class="comment">    /**</span></div>
<div class="line"><span class="comment">     * Implements DictionaryService.checkWord(). Determines</span></div>
<div class="line"><span class="comment">     * if the passed in word is contained in the dictionary.</span></div>
<div class="line"><span class="comment">     * @param word the word to be checked.</span></div>
<div class="line"><span class="comment">     * @return true if the word is in the dictionary,</span></div>
<div class="line"><span class="comment">     *         false otherwise.</span></div>
<div class="line"><span class="comment">     **/</span></div>
<div class="line">    <span class="keywordtype">bool</span> CheckWord(<span class="keyword">const</span> std::string&amp; word)</div>
<div class="line">    {</div>
<div class="line">      std::string lword(word);</div>
<div class="line">      std::transform(lword.begin(), lword.end(), lword.begin(), ::tolower);</div>
<div class="line"></div>
<div class="line">      <span class="keywordflow">return</span> m_dictionary.find(lword) != m_dictionary.end();</div>
<div class="line">    }</div>
<div class="line">  };</div>
<div class="line"></div>
<div class="line">  std::auto_ptr&lt;DictionaryImpl&gt; m_dictionaryService;</div>
<div class="line"></div>
<div class="line"></div>
<div class="line"><span class="keyword">public</span>:</div>
<div class="line"><span class="comment"></span></div>
<div class="line"><span class="comment">  /**</span></div>
<div class="line"><span class="comment">   * Implements ModuleActivator::Load(). Registers an</span></div>
<div class="line"><span class="comment">   * instance of a dictionary service using the module context;</span></div>
<div class="line"><span class="comment">   * attaches properties to the service that can be queried</span></div>
<div class="line"><span class="comment">   * when performing a service look-up.</span></div>
<div class="line"><span class="comment">   * @param context the context for the module.</span></div>
<div class="line"><span class="comment">   */</span></div>
<div class="line">  <span class="keywordtype">void</span> <a class="code" href="structModuleActivator.html#a1db3f85c15a814a5918eb22725229967">Load</a>(<a class="code" href="classModuleContext.html">ModuleContext</a>* context)</div>
<div class="line">  {</div>
<div class="line">    m_dictionaryService.reset(<span class="keyword">new</span> DictionaryImpl);</div>
<div class="line">    <a class="code" href="group__MicroServices.html#ga7c543446fd5f54de926acacfd64e76d6">ServiceProperties</a> props;</div>
<div class="line">    props[<span class="stringliteral">&quot;Language&quot;</span>] = std::string(<span class="stringliteral">&quot;French&quot;</span>);</div>
<div class="line">    context-&gt;<a class="code" href="classModuleContext.html#aa68596c589b57246927067742517ce47">RegisterService</a>&lt;IDictionaryService&gt;(m_dictionaryService.get(), props);</div>
<div class="line">  }</div>
<div class="line"><span class="comment"></span></div>
<div class="line"><span class="comment">  /**</span></div>
<div class="line"><span class="comment">   * Implements ModuleActivator::Unload(). Does nothing since</span></div>
<div class="line"><span class="comment">   * the C++ Micro Services library will automatically unregister any registered services.</span></div>
<div class="line"><span class="comment">   * @param context the context for the module.</span></div>
<div class="line"><span class="comment">   */</span></div>
<div class="line">  <span class="keywordtype">void</span> <a class="code" href="structModuleActivator.html#a410a3f54b7cad990e8d670450677218c">Unload</a>(<a class="code" href="classModuleContext.html">ModuleContext</a>* <span class="comment">/*context*/</span>)</div>
<div class="line">  {</div>
<div class="line">    <span class="comment">// NOTE: The service is automatically unregistered</span></div>
<div class="line">  }</div>
<div class="line"></div>
<div class="line">};</div>
<div class="line"></div>
<div class="line"><a class="code" href="group__MicroServices.html#gac441a2e64f59a76a5f7e42de67e87cba">US_EXPORT_MODULE_ACTIVATOR</a>(frenchdictionary, Activator)</div>
</div><!-- fragment --><p> For an introduction how to compile our source code, see <a class="el" href="MicroServices_Example1.html">Example 1 - Service Event Listener</a>. Because we use the <code>IDictionaryService</code> definition from Example 2, we also need to make sure that the proper include paths and linker dependencies are set:</p>
<div class="fragment"><div class="line">set(_srcs Activator.cpp)</div>
<div class="line"></div>
<div class="line"><a class="code" href="group__MicroServicesCMake.html#ga9b72f7ba11ea53a3039893522d318168">usFunctionGenerateModuleInit</a>(_srcs</div>
<div class="line">                             NAME &quot;French Dictionary&quot;</div>
<div class="line">                             LIBRARY_NAME &quot;frenchdictionary&quot;)</div>
<div class="line"></div>
<div class="line">set(frenchdictionary_DEPENDS dictionaryservice)</div>
<div class="line">CreateExample(frenchdictionary ${_srcs})</div>
</div><!-- fragment --><p>After running the <code>CppMicroServicesExampleDriver</code> program we should make sure that the module from Example 1 is active. We can use the <code>s</code> shell command to get a list of all modules, their state, and their module identifier number. If the Example 1 module is not active, we should load the module using the load command and the module's identifier number or name that is displayed by the <code>s</code> command. Now we can load our dictionary service module by typing the <code>l frenchdictionary</code> command:</p>
<pre class="fragment">CppMicroServices-build&gt; bin/CppMicroServicesExampleDriver
&gt; s
Id | Name                 | Status
-----------------------------------
 - | dictionaryservice    | -
 - | eventlistener        | -
 - | frenchdictionary     | -
 1 | CppMicroServices     | LOADED
&gt; l eventlistener
Starting to listen for service events.
&gt; l frenchdictionary
Ex1: Service of type IDictionaryService/1.0 registered.
Ex1: Service of type IDictionaryService/1.0 registered.
&gt; s
Id | Name                 | Status
-----------------------------------
 1 | CppMicroServices     | LOADED
 2 | Event Listener       | LOADED
 3 | Dictionary Service   | LOADED
 4 | French Dictionary    | LOADED
&gt;
</pre><p>To unload the module, use the <code>u &lt;id&gt;</code> command. If the module from <a class="el" href="MicroServices_Example1.html">Example 1</a> is still active, then we should see it print out the details of the service event it receives when our new module registers its dictionary service. Using the <code>CppMicroServicesExampleDriver</code> commands <code>u</code> and <code>l</code> we can unload and load it at will, respectively. Each time we load and unload our dictionary service module, we should see the details of the associated service event printed from the module from Example 1. In <a class="el" href="MicroServices_Example3.html">Example 3</a>, we will create a client for our dictionary service. To exit <code>CppMicroServicesExampleDriver</code>, we use the <code>q</code> command.</p>
<dl class="section note"><dt>Note</dt><dd>Because our french dictionary module has a link dependency on the dictionary service module from Example 2, this module is automatically loaded by the operating system loader. Unloading it will only succeed if there are no other dependent modules like our french dictionary module currently loaded.</dd></dl>
<p>Next: <a class="el" href="MicroServices_Example3.html">Example 3 - Dictionary Client Module</a></p>
<p>Previous: <a class="el" href="MicroServices_Example2.html">Example 2 - Dictionary Service Module</a> </p>
</div></div><!-- contents -->

  <hr class="footer"/>
  <address class="footer"><small>Generated on Sat Jan 11 2014 for C++ Micro Services 2.1.0 by <a href="http://www.doxygen.org/index.html">Doxygen</a> 1.8.5
</small></address>
