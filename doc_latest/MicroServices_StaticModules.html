---
layout: default
title: Static Modules
---
  <head>
    <title>C++ Micro Services: Static Modules</title>
    <link href="tabs.css" rel="stylesheet" type="text/css"/>
    <script type="text/javascript" src="jquery.js"></script>
    <script type="text/javascript" src="dynsections.js"></script>
    <link href="search/search.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="search/search.js"></script>
<script type="text/javascript">
  $(document).ready(function() { searchBox.OnSelectItem(0); });
</script>
    <link href="doxygen.css" rel="stylesheet" type="text/css" />
    <link href="doxygen_extra.css" rel="stylesheet" type="text/css"/>
  </head>
  <div id="top"><!-- do not remove this div, it is closed by doxygen! -->
<!-- Generated by Doxygen 1.8.3.1 -->
<script type="text/javascript">
var searchBox = new SearchBox("searchBox", "search",false,'Search');
</script>
  <div id="navrow1" class="tabs">
    <ul class="tablist">
      <li><a href="index.html"><span>Main&#160;Page</span></a></li>
      <li class="current"><a href="pages.html"><span>Related&#160;Pages</span></a></li>
      <li><a href="modules.html"><span>Modules</span></a></li>
      <li><a href="namespaces.html"><span>Namespaces</span></a></li>
      <li><a href="annotated.html"><span>Classes</span></a></li>
      <li>
        <div id="MSearchBox" class="MSearchBoxInactive">
        <span class="left">
          <img id="MSearchSelect" src="search/mag_sel.png"
               onmouseover="return searchBox.OnSearchSelectShow()"
               onmouseout="return searchBox.OnSearchSelectHide()"
               alt=""/>
          <input type="text" id="MSearchField" value="Search" accesskey="S"
               onfocus="searchBox.OnSearchFieldFocus(true)" 
               onblur="searchBox.OnSearchFieldFocus(false)" 
               onkeyup="searchBox.OnSearchFieldChange(event)"/>
          </span><span class="right">
            <a id="MSearchClose" href="javascript:searchBox.CloseResultsWindow()"><img id="MSearchCloseImg" border="0" src="search/close.png" alt=""/></a>
          </span>
        </div>
      </li>
    </ul>
  </div>
<!-- window showing the filter options -->
<div id="MSearchSelectWindow"
     onmouseover="return searchBox.OnSearchSelectShow()"
     onmouseout="return searchBox.OnSearchSelectHide()"
     onkeydown="return searchBox.OnSearchSelectKey(event)">
<a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(0)"><span class="SelectionMark">&#160;</span>All</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(1)"><span class="SelectionMark">&#160;</span>Classes</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(2)"><span class="SelectionMark">&#160;</span>Namespaces</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(3)"><span class="SelectionMark">&#160;</span>Functions</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(4)"><span class="SelectionMark">&#160;</span>Variables</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(5)"><span class="SelectionMark">&#160;</span>Typedefs</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(6)"><span class="SelectionMark">&#160;</span>Enumerations</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(7)"><span class="SelectionMark">&#160;</span>Enumerator</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(8)"><span class="SelectionMark">&#160;</span>Friends</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(9)"><span class="SelectionMark">&#160;</span>Groups</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(10)"><span class="SelectionMark">&#160;</span>Pages</a></div>

<!-- iframe showing the search results (closed by default) -->
<div id="MSearchResultsWindow">
<iframe src="javascript:void(0)" frameborder="0" 
        name="MSearchResults" id="MSearchResults">
</iframe>
</div>

<div id="nav-path" class="navpath">
  <ul>
<li class="navelem"><a class="el" href="MicroServices_Tutorials.html">Tutorials</a></li>  </ul>
</div>
</div><!-- top -->
<div class="header">
  <div class="headertitle">
<div class="title">Static Modules </div>  </div>
</div><!--header-->
<div class="contents">
<div class="textblock"><p>The normal and most flexible way to include a CppMicroServices module in an application is to compile it into a shared library that is either linked by another library (or executable) or <a class="el" href="MicroServices_AutoLoading.html">auto-loaded</a> during runtime.</p>
<p>However, modules can be linked statically to your application or shared library. This makes the deployment of your application less error-prone and in the case of a complete static build also minimizes its binary size and start-up time. The disadvantage is that no functionality can be added without a rebuild and redistribution of the application.</p>
<h1>Creating Static Modules</h1>
<p>Static modules are written just like shared modules - there are no differences in the usage of the CppMicroServices API or the provided preprocessor macros. The only thing you need to make sure is that the <code>US_STATIC_MODULE</code> preprocessor macro is defined when building a module statically.</p>
<h1>Using Static Modules</h1>
<p>Static modules can be used (imported) in shared or other static libraries or in the executable itself. Assuming that a static module makes use of the CppMicroServices API (e.g. by registering some services using a <a class="el" href="classModuleContext.html">ModuleContext</a>), the importing library or executable needs to put a call to the <code><a class="el" href="group__MicroServices.html#ga9a64354a3aa6adc882bd73cb193715cb" title="Creates initialization code for a module.">US_INITIALIZE_MODULE</a></code> macro somewhere in its source code. This ensures the availability of a module context which is shared with all imported static libraries (see also <a class="el" href="MicroServices_StaticModules.html#MicroServices_StaticModules_Context">A Note About The Module Context</a>).</p>
<dl class="section note"><dt>Note</dt><dd>Note that if your static module does not export a module activator by using the macro <code><a class="el" href="group__MicroServices.html#gac441a2e64f59a76a5f7e42de67e87cba" title="Export a module activator class.">US_EXPORT_MODULE_ACTIVATOR</a></code> or does not contain embedded resources (see <a class="el" href="MicroServices_Resources.html">The Resources System</a>) you do not need to put the special import macros explained below into your code. You can use and link the static module just like any other static library.</dd></dl>
<p>For every static module you would like to import, you need to put a call to <code><a class="el" href="group__MicroServices.html#ga374168789c5e2653f1ce3460db1b8a24" title="Import a static module.">US_IMPORT_MODULE</a></code> into the source code of the importing library. To make the static module's resources available to the importing module, you must also call <code><a class="el" href="group__MicroServices.html#ga6fda34bdcee9492c28b6f43c4a31b2bc" title="Import a static module&#39;s resources.">US_IMPORT_MODULE_RESOURCES</a></code>. Addidtionally, you need a call to <code><a class="el" href="group__MicroServices.html#gaa01807d90beef417c9107c97b19c3bde" title="Import a list of static modules into a shared library.">US_LOAD_IMPORTED_MODULES</a></code> which contains a space-deliminated list of module names in the importing libaries source code. This ensures that the module activators of the imported static modules (if they exist) are called appropriately and that the embedded resources are registered with the importing module.</p>
<dl class="section note"><dt>Note</dt><dd>When importing a static module into another static module, the call to <code><a class="el" href="group__MicroServices.html#gaa01807d90beef417c9107c97b19c3bde" title="Import a list of static modules into a shared library.">US_LOAD_IMPORTED_MODULES</a></code> in the importing static module will have no effect. This macro can only be used in shared modules or executables.</dd></dl>
<p>There are two main usage scenarios which are explained below together with some example code.</p>
<h2>Using a Shared CppMicroServices Library</h2>
<p>Building the CppMicroServices library as a shared library allows you to import static modules into other shared or static modules or into the executable. As noted above, the importing shared module or executable needs to provide a module context by calling the <code><a class="el" href="group__MicroServices.html#ga9a64354a3aa6adc882bd73cb193715cb" title="Creates initialization code for a module.">US_INITIALIZE_MODULE</a></code> macro. Additionally, you must ensure to use the <code><a class="el" href="group__MicroServices.html#ga61f2450ad1688d94b82b842f97e659f5" title="Import a list of static modules into an executable.">US_LOAD_IMPORTED_MODULES_INTO_MAIN</a></code> macro instead of <code><a class="el" href="group__MicroServices.html#gaa01807d90beef417c9107c97b19c3bde" title="Import a list of static modules into a shared library.">US_LOAD_IMPORTED_MODULES</a></code> when importing static modules into an executable.</p>
<p>Example code for importing the two static modules <code>MyStaticModule1</code> and <code>MyStaticModule2</code> into an executable:</p>
<div class="fragment"><div class="line"><span class="preprocessor">#include &lt;usModuleImport.h&gt;</span></div>
<div class="line"></div>
<div class="line"><a class="code" href="group__MicroServices.html#ga374168789c5e2653f1ce3460db1b8a24" title="Import a static module.">US_IMPORT_MODULE</a>(MyStaticModule1)</div>
<div class="line"><a class="code" href="group__MicroServices.html#ga374168789c5e2653f1ce3460db1b8a24" title="Import a static module.">US_IMPORT_MODULE</a>(MyStaticModule2)</div>
<div class="line"><a class="code" href="group__MicroServices.html#ga6fda34bdcee9492c28b6f43c4a31b2bc" title="Import a static module&#39;s resources.">US_IMPORT_MODULE_RESOURCES</a>(MyStaticModule2)</div>
<div class="line"><a class="code" href="group__MicroServices.html#ga61f2450ad1688d94b82b842f97e659f5" title="Import a list of static modules into an executable.">US_LOAD_IMPORTED_MODULES_INTO_MAIN</a>(MyStaticModule1 MyStaticModule2)</div>
</div><!-- fragment --><p> Importing the static module <code>MyStaticModule</code> into a shared or static module looks like this:</p>
<div class="fragment"><div class="line"><span class="preprocessor">#include &lt;usModuleImport.h&gt;</span></div>
<div class="line"></div>
<div class="line"><a class="code" href="group__MicroServices.html#ga374168789c5e2653f1ce3460db1b8a24" title="Import a static module.">US_IMPORT_MODULE</a>(MyStaticModule)</div>
<div class="line"><a class="code" href="group__MicroServices.html#gaa01807d90beef417c9107c97b19c3bde" title="Import a list of static modules into a shared library.">US_LOAD_IMPORTED_MODULES</a>(HostingModule, MyStaticModule)</div>
</div><!-- fragment --><p> Having a shared CppMicroServices library, the executable also needs some initialization code:</p>
<div class="fragment"><div class="line"><span class="preprocessor">#ifdef US_BUILD_SHARED_LIBS</span></div>
<div class="line"><span class="preprocessor"></span><span class="preprocessor">#include &lt;usModuleInitialization.h&gt;</span></div>
<div class="line"><a class="code" href="group__MicroServices.html#ga9a64354a3aa6adc882bd73cb193715cb" title="Creates initialization code for a module.">US_INITIALIZE_MODULE</a>(<span class="stringliteral">&quot;MyExecutable&quot;</span>, <span class="stringliteral">&quot;&quot;</span>, <span class="stringliteral">&quot;&quot;</span>, <span class="stringliteral">&quot;1.0.0&quot;</span>)</div>
<div class="line"><span class="preprocessor">#endif</span></div>
</div><!-- fragment --><p> Note that shared (but not static) modules also need the <code><a class="el" href="group__MicroServices.html#ga9a64354a3aa6adc882bd73cb193715cb" title="Creates initialization code for a module.">US_INITIALIZE_MODULE</a></code> call when importing static modules, but can omit the US_BUILD_SHARED_LIBS guard.</p>
<h2>Using a Static CppMicroServices Library</h2>
<p>The CppMicroServices library can be build as a static library. In that case, creating shared modules is not supported. If you create shared modules which link a static version of the CppMicroServices library, the runtime behavior is undefined.</p>
<p>In this usage scenario, every module will be statically build and linked to an executable. The executable needs to import all the static modules, just like above:</p>
<div class="fragment"><div class="line"><span class="preprocessor">#include &lt;usModuleImport.h&gt;</span></div>
<div class="line"></div>
<div class="line"><a class="code" href="group__MicroServices.html#ga374168789c5e2653f1ce3460db1b8a24" title="Import a static module.">US_IMPORT_MODULE</a>(MyStaticModule1)</div>
<div class="line"><a class="code" href="group__MicroServices.html#ga374168789c5e2653f1ce3460db1b8a24" title="Import a static module.">US_IMPORT_MODULE</a>(MyStaticModule2)</div>
<div class="line"><a class="code" href="group__MicroServices.html#ga6fda34bdcee9492c28b6f43c4a31b2bc" title="Import a static module&#39;s resources.">US_IMPORT_MODULE_RESOURCES</a>(MyStaticModule2)</div>
<div class="line"><a class="code" href="group__MicroServices.html#ga61f2450ad1688d94b82b842f97e659f5" title="Import a list of static modules into an executable.">US_LOAD_IMPORTED_MODULES_INTO_MAIN</a>(MyStaticModule1 MyStaticModule2)</div>
</div><!-- fragment --><p> However, it can omit the <code><a class="el" href="group__MicroServices.html#ga9a64354a3aa6adc882bd73cb193715cb" title="Creates initialization code for a module.">US_INITIALIZE_MODULE</a></code> macro call (the module context from the CppMicroServices library will be shared across all modules and the executable).</p>
<h1><a class="anchor" id="MicroServices_StaticModules_Context"></a>
A Note About The Module Context</h1>
<p>Modules using the CppMicroServices API frequently need a <code><a class="el" href="classModuleContext.html">ModuleContext</a></code> object to query, retrieve, and register services. Static modules will never get their own module context but will share the context with their importing module or executable. Therefore, the importing module or executable needs to ensure the availability of such a context (by using the <code><a class="el" href="group__MicroServices.html#ga9a64354a3aa6adc882bd73cb193715cb" title="Creates initialization code for a module.">US_INITIALIZE_MODULE</a></code> macro).</p>
<dl class="section note"><dt>Note</dt><dd>The CppMicroServices library will <em>always</em> provide a module context, independent of its library build mode.</dd></dl>
<p>So in a completely statically build application, the CppMicroServices library provides a global module context for all imported modules and the executable. </p>
</div></div><!-- contents -->

  <hr class="footer"/>
  <address class="footer"><small>Generated on Mon Feb 4 2013 for C++ Micro Services 0.99.0 by <a href="http://www.doxygen.org/index.html">Doxygen</a> 1.8.3.1
</small></address>
