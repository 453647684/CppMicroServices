---
layout: default
title: The Resources System
---
  <head>
    <title>C++ Micro Services: The Resources System</title>
    <link href="tabs.css" rel="stylesheet" type="text/css"/>
    <script type="text/javascript" src="jquery.js"></script>
    <script type="text/javascript" src="dynsections.js"></script>
    <link href="search/search.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="search/searchdata.js"></script>
<script type="text/javascript" src="search/search.js"></script>
<script type="text/javascript">
  $(document).ready(function() { init_search(); });
</script>
    <link href="doxygen.css" rel="stylesheet" type="text/css" />
    <link href="doxygen_extra.css" rel="stylesheet" type="text/css"/>
  </head>
  <div id="top"><!-- do not remove this div, it is closed by doxygen! -->
<!-- Generated by Doxygen 1.8.9.1 -->
<script type="text/javascript">
var searchBox = new SearchBox("searchBox", "search",false,'Search');
</script>
  <div id="navrow1" class="tabs">
    <ul class="tablist">
      <li><a href="index.html"><span>Main&#160;Page</span></a></li>
      <li class="current"><a href="pages.html"><span>Related&#160;Pages</span></a></li>
      <li><a href="modules.html"><span>Modules</span></a></li>
      <li><a href="namespaces.html"><span>Namespaces</span></a></li>
      <li><a href="annotated.html"><span>Classes</span></a></li>
      <li>
        <div id="MSearchBox" class="MSearchBoxInactive">
        <span class="left">
          <img id="MSearchSelect" src="search/mag_sel.png"
               onmouseover="return searchBox.OnSearchSelectShow()"
               onmouseout="return searchBox.OnSearchSelectHide()"
               alt=""/>
          <input type="text" id="MSearchField" value="Search" accesskey="S"
               onfocus="searchBox.OnSearchFieldFocus(true)" 
               onblur="searchBox.OnSearchFieldFocus(false)" 
               onkeyup="searchBox.OnSearchFieldChange(event)"/>
          </span><span class="right">
            <a id="MSearchClose" href="javascript:searchBox.CloseResultsWindow()"><img id="MSearchCloseImg" border="0" src="search/close.png" alt=""/></a>
          </span>
        </div>
      </li>
    </ul>
  </div>
<!-- window showing the filter options -->
<div id="MSearchSelectWindow"
     onmouseover="return searchBox.OnSearchSelectShow()"
     onmouseout="return searchBox.OnSearchSelectHide()"
     onkeydown="return searchBox.OnSearchSelectKey(event)">
</div>

<!-- iframe showing the search results (closed by default) -->
<div id="MSearchResultsWindow">
<iframe src="javascript:void(0)" frameborder="0" 
        name="MSearchResults" id="MSearchResults">
</iframe>
</div>

<div id="nav-path" class="navpath">
  <ul>
<li class="navelem"><a class="el" href="MicroServices_UserDocs.html">User Documentation</a></li>  </ul>
</div>
</div><!-- top -->
<div class="header">
  <div class="headertitle">
<div class="title">The Resources System </div>  </div>
</div><!--header-->
<div class="contents">
<div class="textblock"><p>The C++ Micro Services library provides a generic resources system to embed arbitrary files into a module's shared library (the size limitation per resource is 2GB, due to the used ZIP format).</p>
<p>The following features are supported:</p>
<ul>
<li>Embed arbitrary data into shared or static modules or executables.</li>
<li>Data is embedded in a compressed format (zip) with a configurable compression level.</li>
<li>Resources are accessed via a <a class="el" href="classModule.html" title="Represents a CppMicroServices module. ">Module</a> instance, providing individual resource lookup and access for each module.</li>
<li>Resources are managed in a tree hierarchy, modeling the original child - parent relationship on the file-system.</li>
<li>The <a class="el" href="classModuleResource.html" title="Represents a resource (text file, image, etc.) embedded in a CppMicroServices module. ">ModuleResource</a> class provides a high-level API for accessing resource information and traversing the resource tree.</li>
<li>The <a class="el" href="classModuleResourceStream.html" title="An input stream class for ModuleResource objects. ">ModuleResourceStream</a> class provides an STL input stream derived class for the seamless usage of embedded resource data in third-party libraries.</li>
</ul>
<p>The following conventions and limitations apply:</p>
<ul>
<li>Resource entries are stored with case-insensitive names. On case-sensitive file systemes, adding resources with the same name but different capitalization will lead to an error.</li>
<li>Looking up resources by name at runtime <em>is</em> case sensitive.</li>
<li>The CppMicroServices library will search for a valid zip file inside a shared library, starting from the end of the file. If other zip files are embedded in the module as well (e.g. as an additional resource embedded via the Windows RC compiler or using other techniques), it will stop at the first valid zip file and use it a the resource container.</li>
</ul>
<h2>Embedding Resources in a Module </h2>
<p>Resources are embedded into a module's shared or static library (or into an executable) by using the <code>usResourceCompiler</code> executable. It will create a ZIP archive of all input files and can append it to the module file.</p>
<p>If you are using CMake, consider using the provided <code><a class="el" href="group__MicroServicesCMake.html#ga94c0897d7c0b1dd34fdf17ac7e55f6f0" title="Embed resources in a library or executable. ">usFunctionEmbedResources</a></code> CMake macro which handles the invocation of the <code>usResourceCompiler</code> executable and sets up the correct file dependencies. Otherwise, you also need to make sure that the set of static modules linked into a shared module or executable is also in the input file list of your <code>usResourceCompiler</code> call for that shared module or executable.</p>
<p>Here is a full example creating a module and embedding resource data: </p><div class="fragment"><div class="line">set(module_name <span class="stringliteral">&quot;org_me_mymodule&quot;</span>)</div>
<div class="line">set(srcs mymodule.cpp)</div>
<div class="line"></div>
<div class="line"><a class="code" href="group__MicroServicesCMake.html#ga9b72f7ba11ea53a3039893522d318168">usFunctionGenerateModuleInit</a>(srcs)</div>
<div class="line"><a class="code" href="group__MicroServicesCMake.html#ga3650e8bb272492730d4cd60e59c7e397">usFunctionGetResourceSource</a>(TARGET mymodule OUT srcs)</div>
<div class="line"></div>
<div class="line">add_library(mymodule ${srcs})</div>
<div class="line">target_link_libraries(mymodule CppMicroServices)</div>
<div class="line"></div>
<div class="line">set_property(TARGET mymodule APPEND PROPERTY COMPILE_DEFINITIONS US_MODULE_NAME=${module_name})</div>
<div class="line">set_property(TARGET mymodule PROPERTY US_MODULE_NAME ${module_name})</div>
<div class="line"></div>
<div class="line"><a class="code" href="group__MicroServicesCMake.html#ga94c0897d7c0b1dd34fdf17ac7e55f6f0">usFunctionEmbedResources</a>(TARGET mymodule</div>
<div class="line">  FILES hello.txt</div>
<div class="line">)</div>
</div><!-- fragment --><h2>Accessing Resources at Runtime </h2>
<p>Each module provides access to its embedded resources via the <a class="el" href="classModule.html" title="Represents a CppMicroServices module. ">Module</a> class which provides methods returning <a class="el" href="classModuleResource.html" title="Represents a resource (text file, image, etc.) embedded in a CppMicroServices module. ">ModuleResource</a> objects. The <a class="el" href="classModuleResourceStream.html" title="An input stream class for ModuleResource objects. ">ModuleResourceStream</a> class provides a std::istream compatible object to access the resource contents.</p>
<p>The following example shows how to retrieve a resource from each currently loaded module whose path is specified by a module property:</p>
<div class="fragment"><div class="line">  <span class="comment">// Get all loaded modules</span></div>
<div class="line">  std::vector&lt;Module*&gt; modules = moduleCtx-&gt;GetModules();</div>
<div class="line"></div>
<div class="line">  <span class="comment">// Check if a module defines a &quot;service-component&quot; property</span></div>
<div class="line">  <span class="comment">// and use its value to retrieve an embedded resource containing</span></div>
<div class="line">  <span class="comment">// a component description.</span></div>
<div class="line">  <span class="keywordflow">for</span>(std::size_t i = 0; i &lt; modules.size(); ++i)</div>
<div class="line">  {</div>
<div class="line">    <a class="code" href="classModule.html">Module</a>* <span class="keyword">const</span> module = modules[i];</div>
<div class="line">    std::string componentPath = module-&gt;<a class="code" href="classModule.html#a3fa885cfb92466c142e1903bb6fab638">GetProperty</a>(<span class="stringliteral">&quot;service-component&quot;</span>).<a class="code" href="classAny.html#a1e02a2c71be43374cd168bcb5636a969">ToString</a>();</div>
<div class="line">    <span class="keywordflow">if</span> (!componentPath.empty())</div>
<div class="line">    {</div>
<div class="line">      <a class="code" href="classModuleResource.html">ModuleResource</a> componentResource = module-&gt;<a class="code" href="classModule.html#ae663b9033cb569becb414ca4d9064622">GetResource</a>(componentPath);</div>
<div class="line">      <span class="keywordflow">if</span> (!componentResource.<a class="code" href="classModuleResource.html#a0cd14b3d80f77637f0b4be12cbbcf867">IsValid</a>() || componentResource.<a class="code" href="classModuleResource.html#aa43fdda3e69a1401f76d45e6bf9c2bd5">IsDir</a>()) <span class="keywordflow">continue</span>;</div>
<div class="line"></div>
<div class="line">      <span class="comment">// Create a std::istream compatible object and parse the</span></div>
<div class="line">      <span class="comment">// component description.</span></div>
<div class="line">      <a class="code" href="classModuleResourceStream.html">ModuleResourceStream</a> resStream(componentResource);</div>
<div class="line">      parseComponentDefinition(resStream);</div>
<div class="line">    }</div>
<div class="line">  }</div>
</div><!-- fragment --><p> This example could be enhanced to dynamically react to modules being loaded and unloaded, making use of the popular "extender pattern" from OSGi.</p>
<h2>Runtime overhead </h2>
<p>The resources system has the following runtime characteristics:</p>
<ul>
<li>During static initialization of a module, it's ZIP archive header data (if available) is parsed and stored in memory.</li>
<li>Querying <code><a class="el" href="classModule.html" title="Represents a CppMicroServices module. ">Module</a></code> or <code><a class="el" href="classModuleResource.html" title="Represents a resource (text file, image, etc.) embedded in a CppMicroServices module. ">ModuleResource</a></code> objects for resource information will not extract the embedded resource data and hence only has minimal runtime and memory overhead.</li>
<li>Creating a <code><a class="el" href="classModuleResourceStream.html" title="An input stream class for ModuleResource objects. ">ModuleResourceStream</a></code> object will allocate memory for the uncompressed resource data and inflate it. The memory will be free'ed after the <code><a class="el" href="classModuleResourceStream.html" title="An input stream class for ModuleResource objects. ">ModuleResourceStream</a></code> object is destroyed. </li>
</ul>
</div></div><!-- contents -->

  <hr class="footer"/>
  <address class="footer"><small>Generated on Tue Oct 6 2015 for C++ Micro Services 2.99.0 by <a href="http://www.doxygen.org/index.html">Doxygen</a> 1.8.9.1
</small></address>
