---
layout: default
title: Example 2 - Dictionary Service Module
---
  <head>
    <title>C++ Micro Services: Example 2 - Dictionary Service Module</title>
    <link href="tabs.css" rel="stylesheet" type="text/css"/>
    <script type="text/javascript" src="jquery.js"></script>
    <script type="text/javascript" src="dynsections.js"></script>
    <link href="search/search.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="search/search.js"></script>
<script type="text/javascript">
  $(document).ready(function() { searchBox.OnSelectItem(0); });
</script>
    <link href="doxygen.css" rel="stylesheet" type="text/css" />
    <link href="doxygen_extra.css" rel="stylesheet" type="text/css"/>
  </head>
  <div id="top"><!-- do not remove this div, it is closed by doxygen! -->
<!-- Generated by Doxygen 1.8.3.1 -->
<script type="text/javascript">
var searchBox = new SearchBox("searchBox", "search",false,'Search');
</script>
  <div id="navrow1" class="tabs">
    <ul class="tablist">
      <li><a href="index.html"><span>Main&#160;Page</span></a></li>
      <li class="current"><a href="pages.html"><span>Related&#160;Pages</span></a></li>
      <li><a href="modules.html"><span>Modules</span></a></li>
      <li><a href="namespaces.html"><span>Namespaces</span></a></li>
      <li><a href="annotated.html"><span>Classes</span></a></li>
      <li>
        <div id="MSearchBox" class="MSearchBoxInactive">
        <span class="left">
          <img id="MSearchSelect" src="search/mag_sel.png"
               onmouseover="return searchBox.OnSearchSelectShow()"
               onmouseout="return searchBox.OnSearchSelectHide()"
               alt=""/>
          <input type="text" id="MSearchField" value="Search" accesskey="S"
               onfocus="searchBox.OnSearchFieldFocus(true)" 
               onblur="searchBox.OnSearchFieldFocus(false)" 
               onkeyup="searchBox.OnSearchFieldChange(event)"/>
          </span><span class="right">
            <a id="MSearchClose" href="javascript:searchBox.CloseResultsWindow()"><img id="MSearchCloseImg" border="0" src="search/close.png" alt=""/></a>
          </span>
        </div>
      </li>
    </ul>
  </div>
<!-- window showing the filter options -->
<div id="MSearchSelectWindow"
     onmouseover="return searchBox.OnSearchSelectShow()"
     onmouseout="return searchBox.OnSearchSelectHide()"
     onkeydown="return searchBox.OnSearchSelectKey(event)">
<a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(0)"><span class="SelectionMark">&#160;</span>All</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(1)"><span class="SelectionMark">&#160;</span>Classes</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(2)"><span class="SelectionMark">&#160;</span>Namespaces</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(3)"><span class="SelectionMark">&#160;</span>Functions</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(4)"><span class="SelectionMark">&#160;</span>Variables</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(5)"><span class="SelectionMark">&#160;</span>Typedefs</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(6)"><span class="SelectionMark">&#160;</span>Enumerations</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(7)"><span class="SelectionMark">&#160;</span>Enumerator</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(8)"><span class="SelectionMark">&#160;</span>Friends</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(9)"><span class="SelectionMark">&#160;</span>Groups</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(10)"><span class="SelectionMark">&#160;</span>Pages</a></div>

<!-- iframe showing the search results (closed by default) -->
<div id="MSearchResultsWindow">
<iframe src="javascript:void(0)" frameborder="0" 
        name="MSearchResults" id="MSearchResults">
</iframe>
</div>

<div id="nav-path" class="navpath">
  <ul>
<li class="navelem"><a class="el" href="MicroServices_Tutorials.html">Tutorial</a></li>  </ul>
</div>
</div><!-- top -->
<div class="header">
  <div class="headertitle">
<div class="title">Example 2 - Dictionary Service <a class="el" href="classModule.html" title="Represents a CppMicroServices module.">Module</a> </div>  </div>
</div><!--header-->
<div class="contents">
<div class="textblock"><p>This example creates a module that implements a service. Implementing a service is a two-step process, first we must define the interface of the service and then we must define an implementation of the service interface. In this particular example, we will create a dictionary service that we can use to check if a word exists, which indicates if the word is spelled correctly or not. First, we will start by defining a simple dictionary service interface in a file called <code>dictionaryservice/IDictionaryService.h</code>:</p>
<div class="fragment"><div class="line"><span class="preprocessor">#include &lt;usServiceInterface.h&gt;</span></div>
<div class="line"></div>
<div class="line"><span class="preprocessor">#include &lt;string&gt;</span></div>
<div class="line"></div>
<div class="line"><span class="preprocessor">#ifdef Example_dictionaryservice_EXPORTS</span></div>
<div class="line"><span class="preprocessor"></span><span class="preprocessor">  #define DICTIONAYSERVICE_EXPORT US_ABI_EXPORT</span></div>
<div class="line"><span class="preprocessor"></span><span class="preprocessor">#else</span></div>
<div class="line"><span class="preprocessor"></span><span class="preprocessor">  #define DICTIONAYSERVICE_EXPORT US_ABI_IMPORT</span></div>
<div class="line"><span class="preprocessor"></span><span class="preprocessor">#endif</span></div>
<div class="line"><span class="preprocessor"></span><span class="comment"></span></div>
<div class="line"><span class="comment">/**</span></div>
<div class="line"><span class="comment"> * A simple service interface that defines a dictionary service.</span></div>
<div class="line"><span class="comment"> * A dictionary service simply verifies the existence of a word.</span></div>
<div class="line"><span class="comment"> **/</span></div>
<div class="line"><span class="keyword">struct </span>DICTIONAYSERVICE_EXPORT IDictionaryService</div>
<div class="line">{</div>
<div class="line">  <span class="comment">// Out-of-line virtual desctructor for proper dynamic cast</span></div>
<div class="line">  <span class="comment">// support with older versions of gcc.</span></div>
<div class="line">  <span class="keyword">virtual</span> ~IDictionaryService();</div>
<div class="line"><span class="comment"></span></div>
<div class="line"><span class="comment">  /**</span></div>
<div class="line"><span class="comment">   * Check for the existence of a word.</span></div>
<div class="line"><span class="comment">   * @param word the word to be checked.</span></div>
<div class="line"><span class="comment">   * @return true if the word is in the dictionary,</span></div>
<div class="line"><span class="comment">   *         false otherwise.</span></div>
<div class="line"><span class="comment">   **/</span></div>
<div class="line">  <span class="keyword">virtual</span> <span class="keywordtype">bool</span> CheckWord(<span class="keyword">const</span> std::string&amp; word) = 0;</div>
<div class="line">};</div>
<div class="line"></div>
<div class="line"><a class="code" href="group__MicroServices.html#gad5c1340dcd99d403c8da0c52b8db30bb" title="Declare a CppMicroServices service interface.">US_DECLARE_SERVICE_INTERFACE</a>(IDictionaryService, <span class="stringliteral">&quot;IDictionaryService/1.0&quot;</span>)</div>
</div><!-- fragment --><p> The service interface is quite simple, with only one method that needs to be implemented. Because we provide an empty out-of-line destructor (defined in the file <code>IDictionaryService.cpp</code>) we must export the service interface by using the module specific <code>DICTIONARYSERVICE_EXPORT</code> macro.</p>
<p>In the following source code, the module uses its module context to register the dictionary service. We implement the dictionary service as an inner class of the module activator class, but we could have also put it in a separate file. The source code for our module is as follows in a file called <code>dictionaryservice/Activator.cpp</code>:</p>
<div class="fragment"><div class="line"><span class="preprocessor">#include &quot;IDictionaryService.h&quot;</span></div>
<div class="line"></div>
<div class="line"><span class="preprocessor">#include &lt;usModuleActivator.h&gt;</span></div>
<div class="line"><span class="preprocessor">#include &lt;usModuleContext.h&gt;</span></div>
<div class="line"><span class="preprocessor">#include &lt;usServiceProperties.h&gt;</span></div>
<div class="line"></div>
<div class="line"><span class="comment">// Replace that include with your own base class declaration</span></div>
<div class="line"><span class="preprocessor">#include US_BASECLASS_HEADER</span></div>
<div class="line"><span class="preprocessor"></span></div>
<div class="line"><span class="preprocessor">#include &lt;set&gt;</span></div>
<div class="line"><span class="preprocessor">#include &lt;memory&gt;</span></div>
<div class="line"></div>
<div class="line">US_USE_NAMESPACE</div>
<div class="line"><span class="comment"></span></div>
<div class="line"><span class="comment">/**</span></div>
<div class="line"><span class="comment"> * This class implements a module activator that uses the module</span></div>
<div class="line"><span class="comment"> * context to register an English language dictionary service</span></div>
<div class="line"><span class="comment"> * with the C++ Micro Services registry during static initialization</span></div>
<div class="line"><span class="comment"> * of the module. The dictionary service interface is</span></div>
<div class="line"><span class="comment"> * defined in a separate file and is implemented by a nested class.</span></div>
<div class="line"><span class="comment"> */</span></div>
<div class="line"><span class="keyword">class </span>US_ABI_LOCAL Activator : <span class="keyword">public</span> <a class="code" href="structModuleActivator.html" title="Customizes the starting and stopping of a CppMicroServices module.">ModuleActivator</a></div>
<div class="line">{</div>
<div class="line"></div>
<div class="line"><span class="keyword">private</span>:</div>
<div class="line"><span class="comment"></span></div>
<div class="line"><span class="comment">  /**</span></div>
<div class="line"><span class="comment">   * A private inner class that implements a dictionary service;</span></div>
<div class="line"><span class="comment">   * see IDictionaryService for details of the service.</span></div>
<div class="line"><span class="comment">   */</span></div>
<div class="line">  <span class="keyword">class </span>DictionaryImpl : <span class="keyword">public</span> US_BASECLASS_NAME, <span class="keyword">public</span> IDictionaryService</div>
<div class="line">  {</div>
<div class="line">    <span class="comment">// The set of words contained in the dictionary.</span></div>
<div class="line">    std::set&lt;std::string&gt; m_dictionary;</div>
<div class="line"></div>
<div class="line">  <span class="keyword">public</span>:</div>
<div class="line"></div>
<div class="line">    DictionaryImpl()</div>
<div class="line">    {</div>
<div class="line">      m_dictionary.insert(<span class="stringliteral">&quot;welcome&quot;</span>);</div>
<div class="line">      m_dictionary.insert(<span class="stringliteral">&quot;to&quot;</span>);</div>
<div class="line">      m_dictionary.insert(<span class="stringliteral">&quot;the&quot;</span>);</div>
<div class="line">      m_dictionary.insert(<span class="stringliteral">&quot;micro&quot;</span>);</div>
<div class="line">      m_dictionary.insert(<span class="stringliteral">&quot;services&quot;</span>);</div>
<div class="line">      m_dictionary.insert(<span class="stringliteral">&quot;tutorial&quot;</span>);</div>
<div class="line">    }</div>
<div class="line"><span class="comment"></span></div>
<div class="line"><span class="comment">    /**</span></div>
<div class="line"><span class="comment">     * Implements IDictionaryService::CheckWord(). Determines</span></div>
<div class="line"><span class="comment">     * if the passed in word is contained in the dictionary.</span></div>
<div class="line"><span class="comment">     * @param word the word to be checked.</span></div>
<div class="line"><span class="comment">     * @return true if the word is in the dictionary,</span></div>
<div class="line"><span class="comment">     *         false otherwise.</span></div>
<div class="line"><span class="comment">     **/</span></div>
<div class="line">    <span class="keywordtype">bool</span> CheckWord(<span class="keyword">const</span> std::string&amp; word)</div>
<div class="line">    {</div>
<div class="line">      std::string lword(word);</div>
<div class="line">      std::transform(lword.begin(), lword.end(), lword.begin(), ::tolower);</div>
<div class="line"></div>
<div class="line">      <span class="keywordflow">return</span> m_dictionary.find(lword) != m_dictionary.end();</div>
<div class="line">    }</div>
<div class="line">  };</div>
<div class="line"></div>
<div class="line">  std::auto_ptr&lt;DictionaryImpl&gt; m_dictionaryService;</div>
<div class="line"></div>
<div class="line"></div>
<div class="line"><span class="keyword">public</span>:</div>
<div class="line"><span class="comment"></span></div>
<div class="line"><span class="comment">  /**</span></div>
<div class="line"><span class="comment">   * Implements ModuleActivator::Load(). Registers an</span></div>
<div class="line"><span class="comment">   * instance of a dictionary service using the module context;</span></div>
<div class="line"><span class="comment">   * attaches properties to the service that can be queried</span></div>
<div class="line"><span class="comment">   * when performing a service look-up.</span></div>
<div class="line"><span class="comment">   * @param context the context for the module.</span></div>
<div class="line"><span class="comment">   */</span></div>
<div class="line">  <span class="keywordtype">void</span> <a class="code" href="structModuleActivator.html#a1db3f85c15a814a5918eb22725229967" title="Called when this module is loaded.">Load</a>(<a class="code" href="classModuleContext.html" title="A module&#39;s execution context within the framework.">ModuleContext</a>* context)</div>
<div class="line">  {</div>
<div class="line">    m_dictionaryService.reset(<span class="keyword">new</span> DictionaryImpl);</div>
<div class="line">    <a class="code" href="group__MicroServices.html#ga7c543446fd5f54de926acacfd64e76d6" title="A hash table with std::string as the key type and Any as the value type.">ServiceProperties</a> props;</div>
<div class="line">    props[<span class="stringliteral">&quot;Language&quot;</span>] = std::string(<span class="stringliteral">&quot;English&quot;</span>);</div>
<div class="line">    context-&gt;<a class="code" href="classModuleContext.html#a7399fcc65ae1625cc06e4010e9e262d6" title="Registers the specified service object with the specified properties under the specified class names ...">RegisterService</a>&lt;IDictionaryService&gt;(m_dictionaryService.get(), props);</div>
<div class="line">  }</div>
<div class="line"><span class="comment"></span></div>
<div class="line"><span class="comment">  /**</span></div>
<div class="line"><span class="comment">   * Implements ModuleActivator::Unload(). Does nothing since</span></div>
<div class="line"><span class="comment">   * the C++ Micro Services library will automatically unregister any registered services.</span></div>
<div class="line"><span class="comment">   * @param context the context for the module.</span></div>
<div class="line"><span class="comment">   */</span></div>
<div class="line">  <span class="keywordtype">void</span> <a class="code" href="structModuleActivator.html#a410a3f54b7cad990e8d670450677218c" title="Called when this module is unloaded.">Unload</a>(<a class="code" href="classModuleContext.html" title="A module&#39;s execution context within the framework.">ModuleContext</a>* <span class="comment">/*context*/</span>)</div>
<div class="line">  {</div>
<div class="line">    <span class="comment">// NOTE: The service is automatically unregistered</span></div>
<div class="line">  }</div>
<div class="line"></div>
<div class="line">};</div>
<div class="line"></div>
<div class="line"><a class="code" href="group__MicroServices.html#gac441a2e64f59a76a5f7e42de67e87cba" title="Export a module activator class.">US_EXPORT_MODULE_ACTIVATOR</a>(dictionaryservice, Activator)</div>
</div><!-- fragment --><p> Note that we do not need to unregister the service in the Unload() method, because the C++ Micro Services library will automatically do so for us. The dictionary service that we have implemented is very simple; its dictionary is a set of only five words, so this solution is not optimal and is only intended for educational purposes.</p>
<dl class="section note"><dt>Note</dt><dd>In this example, the service interface and implementation are both contained in one module which exports the interface class. However, service implementations almost never need to be exported and in many use cases it is beneficial to provide the service interface and its implementation(s) in separate modules. In such a scenario, clients of a service will only have a link-time dependency on the shared library providing the service interface (because of the out-of-line destructor) but not on any modules containing service implementations. This often leads to modules which do not export any symbols at all and hence need to be loaded into the running process manually or by using the <a class="el" href="MicroServices_AutoLoading.html">auto-loading mechanism</a>.</dd></dl>
<p>For an introduction how to compile our source code, see <a class="el" href="MicroServices_Example1.html">Example 1 - Service Event Listener</a>.</p>
<p>After running the <code>CppMicroServicesExampleDriver</code> program we should make sure that the module from Example 1 is active. We can use the <code>s</code> shell command to get a list of all modules, their state, and their module identifier number. If the Example 1 module is not active, we should load the module using the load command and the module's identifier number or name that is displayed by the <code>s</code> command. Now we can load our dictionary service module by typing the <code>l dictionaryservice</code> command:</p>
<pre class="fragment">CppMicroServices-build&gt; bin/CppMicroServicesExampleDriver
&gt; s
Id | Name                 | Status
-----------------------------------
 - | dictionaryservice    | -
 - | eventlistener        | -
 1 | CppMicroServices     | LOADED
&gt; l eventlistener
Starting to listen for service events.
&gt; l dictionaryservice
Ex1: Service of type IDictionaryService/1.0 registered.
&gt; s
Id | Name                 | Status
-----------------------------------
 1 | CppMicroServices     | LOADED
 2 | Event Listener       | LOADED
 3 | Dictionary Service   | LOADED
&gt; 
</pre><p>To unload the module, use the <code>u &lt;id&gt;</code> command. If the module from <a class="el" href="MicroServices_Example1.html">Example 1</a> is still active, then we should see it print out the details of the service event it receives when our new module registers its dictionary service. Using the <code>CppMicroServicesExampleDriver</code> commands <code>u</code> and <code>l</code> we can unload and load it at will, respectively. Each time we load and unload our dictionary service module, we should see the details of the associated service event printed from the module from Example 1. In <a class="el" href="MicroServices_Example3.html">Example 3</a>, we will create a client for our dictionary service. To exit <code>CppMicroServicesExampleDriver</code>, we use the <code>q</code> command.</p>
<p>Next: <a class="el" href="MicroServices_Example2b.html">Example 2b - Alternative Dictionary Service Module</a></p>
<p>Previous: <a class="el" href="MicroServices_Example1.html">Example 1 - Service Event Listener</a> </p>
</div></div><!-- contents -->

  <hr class="footer"/>
  <address class="footer"><small>Generated on Fri Jul 19 2013 for C++ Micro Services 1.99.0 by <a href="http://www.doxygen.org/index.html">Doxygen</a> 1.8.3.1
</small></address>
