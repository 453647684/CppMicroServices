---
layout: default
title: Implementing A Dictionary Service
---

  <head>

    <!-- Le HTML5 shim, for IE6-8 support of HTML elements -->
    <!--[if lt IE 9]>
      <script src="http://html5shim.googlecode.com/svn/trunk/html5.js"></script>
    <![endif]-->
    
    <link href="doxygen.css" rel="stylesheet" type="text/css" />
    
    
    <link href="search/search.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="jquery.js"></script>
<script type="text/javascript" src="search/search.js"></script>
<script type="text/javascript">
  $(document).ready(function() { searchBox.OnSelectItem(0); });
</script>
    
    
    <style>
      #MSearchField { height: 14px; }
      #MSearchClose { top: 1px; }
    </style>

  </head>

  <div class="doxygen-header" id="top"><!-- do not remove this div! -->
  
<!-- Generated by Doxygen 1.8.0-20120408 -->
<script type="text/javascript">
var searchBox = new SearchBox("searchBox", "search",false,'Search');
</script>
  <div id="navrow1" class="tabs">
    <ul class="tablist">
      <li><a href="index.html"><span>Main&#160;Page</span></a></li>
      <li class="current"><a href="pages.html"><span>Related&#160;Pages</span></a></li>
      <li><a href="modules.html"><span>Modules</span></a></li>
      <li><a href="namespaces.html"><span>Namespaces</span></a></li>
      <li><a href="annotated.html"><span>Classes</span></a></li>
      <li>
        <div id="MSearchBox" class="MSearchBoxInactive">
        <span class="left">
          <img id="MSearchSelect" src="search/mag_sel.png"
               onmouseover="return searchBox.OnSearchSelectShow()"
               onmouseout="return searchBox.OnSearchSelectHide()"
               alt=""/>
          <input type="text" id="MSearchField" value="Search" accesskey="S"
               onfocus="searchBox.OnSearchFieldFocus(true)" 
               onblur="searchBox.OnSearchFieldFocus(false)" 
               onkeyup="searchBox.OnSearchFieldChange(event)"/>
          </span><span class="right">
            <a id="MSearchClose" href="javascript:searchBox.CloseResultsWindow()"><img id="MSearchCloseImg" border="0" src="search/close.png" alt=""/></a>
          </span>
        </div>
      </li>
    </ul>
  </div>
<!-- window showing the filter options -->
<div id="MSearchSelectWindow"
     onmouseover="return searchBox.OnSearchSelectShow()"
     onmouseout="return searchBox.OnSearchSelectHide()"
     onkeydown="return searchBox.OnSearchSelectKey(event)">
<a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(0)"><span class="SelectionMark">&#160;</span>All</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(1)"><span class="SelectionMark">&#160;</span>Classes</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(2)"><span class="SelectionMark">&#160;</span>Namespaces</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(3)"><span class="SelectionMark">&#160;</span>Functions</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(4)"><span class="SelectionMark">&#160;</span>Variables</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(5)"><span class="SelectionMark">&#160;</span>Typedefs</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(6)"><span class="SelectionMark">&#160;</span>Enumerations</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(7)"><span class="SelectionMark">&#160;</span>Enumerator</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(8)"><span class="SelectionMark">&#160;</span>Friends</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(9)"><span class="SelectionMark">&#160;</span>Groups</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(10)"><span class="SelectionMark">&#160;</span>Pages</a></div>

<!-- iframe showing the search results (closed by default) -->
<div id="MSearchResultsWindow">
<iframe src="javascript:void(0)" frameborder="0" 
        name="MSearchResults" id="MSearchResults">
</iframe>
</div>

  <div id="nav-path" class="navpath">
    <ul>
      <li class="navelem"><a class="el" href="MicroServices_Examples.html">Examples</a>      </li>
    </ul>
  </div>
</div>
<div class="header">
  <div class="headertitle">
<div class="title">Implementing A Dictionary Service </div>  </div>
</div><!--header-->
<div class="contents">
<div class="textblock"><p>This example demonstrates how to implement a service object. First, we must define the service interface and then we define an implementation of that interface. In this particular example, we will create a dictionary service that we can use to check if a word exists, which indicates if the word is spelled correctly or not.</p>
<p>We start by defining the dictionary interface (for example in a file called DictionaryService.h):</p>
<div class="fragment"><pre class="fragment"><span class="preprocessor">#ifndef DICTIONARYSERVICE_H</span>
<span class="preprocessor"></span><span class="preprocessor">#define DICTIONARYSERVICE_H</span>
<span class="preprocessor"></span>
<span class="preprocessor">#include &lt;usServiceInterface.h&gt;</span>

<span class="preprocessor">#include &lt;string&gt;</span>

<span class="keyword">struct </span>DictionaryService
{
  <span class="keyword">virtual</span> ~DictionaryService() {}

  <span class="keyword">virtual</span> <span class="keywordtype">bool</span> checkWord(<span class="keyword">const</span> std::string&amp; word) = 0;
};

US_DECLARE_SERVICE_INTERFACE(DictionaryService, <span class="stringliteral">&quot;DictionaryService/1.0&quot;</span>)

<span class="preprocessor">#endif // DICTIONARYSERVICE_H</span>
</pre></div><p>The service interface is quite simple, with only one method that needs to be implemented. Notice that the file does only contain the interface declaration and no actual code.</p>
<p>In the following source code, the module uses its module context to register the dictionary service. We implement the dictionary service as an inner class of the module activator class, but we could have also put it in a separate file. Also note that there is no need to explicityl export any symbols from the module.</p>
<div class="fragment"><pre class="fragment"><span class="preprocessor">#include &quot;DictionaryService.h&quot;</span>

<span class="preprocessor">#include &lt;usModuleActivator.h&gt;</span>
<span class="preprocessor">#include &lt;usModuleContext.h&gt;</span>
<span class="preprocessor">#include &lt;usServiceProperties.h&gt;</span>

<span class="comment">// Replace that include with your own base class declaration</span>
<span class="preprocessor">#include &lt;usBase.h&gt;</span>

<span class="preprocessor">#include &lt;algorithm&gt;</span>
<span class="preprocessor">#include &lt;memory&gt;</span>

US_USE_NAMESPACE

<span class="keyword">class </span>US_ABI_LOCAL MyActivator : <span class="keyword">public</span> <a class="code" href="structModuleActivator.html">ModuleActivator</a>
{

<span class="keyword">private</span>:

  <span class="keyword">class </span>DictionaryImpl : <span class="keyword">public</span> <a class="code" href="classBase.html">Base</a>, <span class="keyword">public</span> DictionaryService
  {
    <span class="comment">// The set of words contained in the dictionary.</span>
    US_UNORDERED_SET_TYPE&lt;std::string&gt; m_dictionary;

  <span class="keyword">public</span>:

    DictionaryImpl()
    {
      m_dictionary.insert(<span class="stringliteral">&quot;welcome&quot;</span>);
      m_dictionary.insert(<span class="stringliteral">&quot;to&quot;</span>);
      m_dictionary.insert(<span class="stringliteral">&quot;the&quot;</span>);
      m_dictionary.insert(<span class="stringliteral">&quot;micro&quot;</span>);
      m_dictionary.insert(<span class="stringliteral">&quot;services&quot;</span>);
      m_dictionary.insert(<span class="stringliteral">&quot;tutorial&quot;</span>);
    }

    <span class="keywordtype">bool</span> checkWord(<span class="keyword">const</span> std::string&amp; word)
    {
      std::string lword(word);
      std::transform(lword.begin(), lword.end(), lword.begin(), ::tolower);

      <span class="keywordflow">return</span> m_dictionary.find(lword) != m_dictionary.end();
    }
  };

  std::auto_ptr&lt;DictionaryImpl&gt; m_dictionaryService;


<span class="keyword">public</span>:

  <span class="keywordtype">void</span> <a class="code" href="structModuleActivator.html#a1db3f85c15a814a5918eb22725229967">Load</a>(<a class="code" href="classModuleContext.html">ModuleContext</a>* context)
  {
    m_dictionaryService.reset(<span class="keyword">new</span> DictionaryImpl);
    <a class="code" href="group__MicroServices.html#gac4d162a4eba031ad968f5bd54272c166">ServiceProperties</a> props;
    props[<span class="stringliteral">&quot;Language&quot;</span>] = std::string(<span class="stringliteral">&quot;English&quot;</span>);
    context-&gt;<a class="code" href="classModuleContext.html#a7399fcc65ae1625cc06e4010e9e262d6">RegisterService</a>&lt;DictionaryService&gt;(m_dictionaryService.get(), props);
  }

  <span class="keywordtype">void</span> <a class="code" href="structModuleActivator.html#a410a3f54b7cad990e8d670450677218c">Unload</a>(<a class="code" href="classModuleContext.html">ModuleContext</a>* <span class="comment">/*context*/</span>)
  {
    <span class="comment">// NOTE: The service is automatically unregistered</span>
  }

};

US_EXPORT_MODULE_ACTIVATOR(DictionaryServiceModule, MyActivator)
</pre></div><p> Note that we do not need to unregister the service in the <code>Unload</code> method, because it will be done automatically for us during static de-initialization of the module.</p>
<p>In the last line, we "export" the module activator, assuming that it is contained in a module named <code>DictionaryServiceModule</code>. We can get the highest ranking service implementation for the DictionaryService interface by querying the service registry via the module context:</p>
<div class="fragment"><pre class="fragment">  <a class="code" href="classServiceReference.html">ServiceReference</a> dictionaryServiceRef = GetModuleContext()-&gt;<a class="code" href="classModuleContext.html#ad4e3f72bad1067aba49283e851448253">GetServiceReference</a>&lt;DictionaryService&gt;();
  <span class="keywordflow">if</span> (dictionaryServiceRef)
  {
    DictionaryService* dictionaryService = GetModuleContext()-&gt;<a class="code" href="classModuleContext.html#a2bdfe2bcbae824b0cd6aa79bc4489850">GetService</a>&lt;DictionaryService&gt;(dictionaryServiceRef);
    <span class="keywordflow">if</span> (dictionaryService)
    {
      std::cout &lt;&lt; <span class="stringliteral">&quot;Dictionary contains &#39;Tutorial&#39;: &quot;</span> &lt;&lt; dictionaryService-&gt;checkWord(<span class="stringliteral">&quot;Tutorial&quot;</span>) &lt;&lt; std::endl;
    }
  }
</pre></div></div></div><!-- contents -->


  <hr class="footer"/>
  <address class="footer"><small>Generated on Mon Apr 16 2012 for C++ Micro Services 0.99.0 by <a href="http://www.doxygen.org/index.html">Doxygen</a> 1.8.0-20120408
  </small></address>

