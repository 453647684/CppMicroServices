---
layout: default
title: Example 1 - Service Event Listener
---
  <head>
    <title>C++ Micro Services: Example 1 - Service Event Listener</title>
    <link href="tabs.css" rel="stylesheet" type="text/css"/>
    <script type="text/javascript" src="jquery.js"></script>
    <script type="text/javascript" src="dynsections.js"></script>
    <link href="search/search.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="search/searchdata.js"></script>
<script type="text/javascript" src="search/search.js"></script>
<script type="text/javascript">
  $(document).ready(function() { init_search(); });
</script>
    <link href="doxygen.css" rel="stylesheet" type="text/css" />
    <link href="doxygen_extra.css" rel="stylesheet" type="text/css"/>
  </head>
  <div id="top"><!-- do not remove this div, it is closed by doxygen! -->
<!-- Generated by Doxygen 1.8.9.1 -->
<script type="text/javascript">
var searchBox = new SearchBox("searchBox", "search",false,'Search');
</script>
  <div id="navrow1" class="tabs">
    <ul class="tablist">
      <li><a href="index.html"><span>Main&#160;Page</span></a></li>
      <li class="current"><a href="pages.html"><span>Related&#160;Pages</span></a></li>
      <li><a href="modules.html"><span>Modules</span></a></li>
      <li><a href="namespaces.html"><span>Namespaces</span></a></li>
      <li><a href="annotated.html"><span>Classes</span></a></li>
      <li>
        <div id="MSearchBox" class="MSearchBoxInactive">
        <span class="left">
          <img id="MSearchSelect" src="search/mag_sel.png"
               onmouseover="return searchBox.OnSearchSelectShow()"
               onmouseout="return searchBox.OnSearchSelectHide()"
               alt=""/>
          <input type="text" id="MSearchField" value="Search" accesskey="S"
               onfocus="searchBox.OnSearchFieldFocus(true)" 
               onblur="searchBox.OnSearchFieldFocus(false)" 
               onkeyup="searchBox.OnSearchFieldChange(event)"/>
          </span><span class="right">
            <a id="MSearchClose" href="javascript:searchBox.CloseResultsWindow()"><img id="MSearchCloseImg" border="0" src="search/close.png" alt=""/></a>
          </span>
        </div>
      </li>
    </ul>
  </div>
<!-- window showing the filter options -->
<div id="MSearchSelectWindow"
     onmouseover="return searchBox.OnSearchSelectShow()"
     onmouseout="return searchBox.OnSearchSelectHide()"
     onkeydown="return searchBox.OnSearchSelectKey(event)">
</div>

<!-- iframe showing the search results (closed by default) -->
<div id="MSearchResultsWindow">
<iframe src="javascript:void(0)" frameborder="0" 
        name="MSearchResults" id="MSearchResults">
</iframe>
</div>

<div id="nav-path" class="navpath">
  <ul>
<li class="navelem"><a class="el" href="MicroServices_Tutorials.html">Tutorial</a></li>  </ul>
</div>
</div><!-- top -->
<div class="header">
  <div class="headertitle">
<div class="title">Example 1 - Service Event Listener </div>  </div>
</div><!--header-->
<div class="contents">
<div class="textblock"><p>This example creates a simple module that listens for service events. This example does not do much at first, because it only prints out the details of registering and unregistering services. In the next example we will create a module that implements a service, which will cause this module to actually do something. For now, we will just use this example to help us understand the basics of creating a module and its activator.</p>
<p>A module gains access to the C++ Micro Services API using a unique instance of <a class="el" href="classModuleContext.html" title="A module&#39;s execution context within the framework. ">ModuleContext</a>. This unique module context can be used during static initialization of the module or at any later point during the life-time of the module. To execute code during static initialization (and de-initialization) time, the module must provide an implementation of the <a class="el" href="structModuleActivator.html" title="Customizes the starting and stopping of a CppMicroServices module. ">ModuleActivator</a> interface; this interface has two methods, Load() and Unload(), that both receive the module's context and are called when the module is loaded (statically initialized) and unloaded, respectively.</p>
<dl class="section note"><dt>Note</dt><dd>You do not need to remember the <a class="el" href="classModuleContext.html" title="A module&#39;s execution context within the framework. ">ModuleContext</a> instance within the <a class="el" href="structModuleActivator.html#a1db3f85c15a814a5918eb22725229967" title="Called when this module is loaded. ">ModuleActivator::Load()</a> method and provide custom access methods for later retrieval. Use the <a class="el" href="group__MicroServices.html#ga41b3658ea10e3163c894439dc62bdfb4" title="Returns the module context of the calling module. ">GetModuleContext()</a> function to easily retrieve the current module's context.</dd></dl>
<p>In the following source code, our module implements the <a class="el" href="structModuleActivator.html" title="Customizes the starting and stopping of a CppMicroServices module. ">ModuleActivator</a> interface and uses the context to add itself as a listener for service events (in the <code>eventlistener/Activator.cpp</code> file):</p>
<div class="fragment"><div class="line"><span class="preprocessor">#include &lt;iostream&gt;</span></div>
<div class="line"><span class="preprocessor">#include &lt;usModuleActivator.h&gt;</span></div>
<div class="line"><span class="preprocessor">#include &lt;usModuleContext.h&gt;</span></div>
<div class="line"><span class="preprocessor">#include &lt;usServiceEvent.h&gt;</span></div>
<div class="line"></div>
<div class="line">US_USE_NAMESPACE</div>
<div class="line"></div>
<div class="line"><span class="keyword">namespace </span>{</div>
<div class="line"><span class="comment"></span></div>
<div class="line"><span class="comment">/**</span></div>
<div class="line"><span class="comment"> * This class implements a simple module that utilizes the CppMicroServices&#39;s</span></div>
<div class="line"><span class="comment"> * event mechanism to listen for service events. Upon receiving a service event,</span></div>
<div class="line"><span class="comment"> * it prints out the event&#39;s details.</span></div>
<div class="line"><span class="comment"> */</span></div>
<div class="line"><span class="keyword">class </span>Activator : <span class="keyword">public</span> <a class="code" href="structModuleActivator.html">ModuleActivator</a></div>
<div class="line">{</div>
<div class="line"></div>
<div class="line"><span class="keyword">private</span>:</div>
<div class="line"><span class="comment"></span></div>
<div class="line"><span class="comment">  /**</span></div>
<div class="line"><span class="comment">   * Implements ModuleActivator::Load(). Prints a message and adds a member</span></div>
<div class="line"><span class="comment">   * function to the module context as a service listener.</span></div>
<div class="line"><span class="comment">   *</span></div>
<div class="line"><span class="comment">   * @param context the framework context for the module.</span></div>
<div class="line"><span class="comment">   */</span></div>
<div class="line">  <span class="keywordtype">void</span> Load(<a class="code" href="classModuleContext.html">ModuleContext</a>* context)</div>
<div class="line">  {</div>
<div class="line">    std::cout &lt;&lt; <span class="stringliteral">&quot;Starting to listen for service events.&quot;</span> &lt;&lt; std::endl;</div>
<div class="line">    context-&gt;<a class="code" href="classModuleContext.html#a649b0101ead2e7beef159191484b7913">AddServiceListener</a>(<span class="keyword">this</span>, &amp;Activator::ServiceChanged);</div>
<div class="line">  }</div>
<div class="line"><span class="comment"></span></div>
<div class="line"><span class="comment">  /**</span></div>
<div class="line"><span class="comment">   * Implements ModuleActivator::Unload(). Prints a message and removes the</span></div>
<div class="line"><span class="comment">   * member function from the module context as a service listener.</span></div>
<div class="line"><span class="comment">   *</span></div>
<div class="line"><span class="comment">   * @param context the framework context for the module.</span></div>
<div class="line"><span class="comment">   */</span></div>
<div class="line">  <span class="keywordtype">void</span> Unload(<a class="code" href="classModuleContext.html">ModuleContext</a>* context)</div>
<div class="line">  {</div>
<div class="line">    context-&gt;<a class="code" href="classModuleContext.html#ae59a924bd2d3bf4d8c77abe4a0f61bd8">RemoveServiceListener</a>(<span class="keyword">this</span>, &amp;Activator::ServiceChanged);</div>
<div class="line">    std::cout &lt;&lt; <span class="stringliteral">&quot;Stopped listening for service events.&quot;</span> &lt;&lt; std::endl;</div>
<div class="line"></div>
<div class="line">    <span class="comment">// Note: It is not required that we remove the listener here,</span></div>
<div class="line">    <span class="comment">// since the framework will do it automatically anyway.</span></div>
<div class="line">  }</div>
<div class="line"><span class="comment"></span></div>
<div class="line"><span class="comment">  /**</span></div>
<div class="line"><span class="comment">   * Prints the details of any service event from the framework.</span></div>
<div class="line"><span class="comment">   *</span></div>
<div class="line"><span class="comment">   * @param event the fired service event.</span></div>
<div class="line"><span class="comment">   */</span></div>
<div class="line">  <span class="keywordtype">void</span> ServiceChanged(<span class="keyword">const</span> <a class="code" href="classServiceEvent.html">ServiceEvent</a>&amp; event)</div>
<div class="line">  {</div>
<div class="line">    std::string objectClass = ref_any_cast&lt;std::vector&lt;std::string&gt; &gt;(<span class="keyword">event</span>.GetServiceReference().GetProperty(<a class="code" href="namespaceServiceConstants.html#a0e099b4cc3cf6e80301486024950b262">ServiceConstants::OBJECTCLASS</a>())).front();</div>
<div class="line"></div>
<div class="line">    <span class="keywordflow">if</span> (event.<a class="code" href="classServiceEvent.html#a5aa8635186e778407c75dbbd3b0a5fc8">GetType</a>() == <a class="code" href="group__MicroServices.html#ggae7426fe742bd938523b64d43c232a49fa658bb6e21586fc2d75ca841244199cd2">ServiceEvent::REGISTERED</a>)</div>
<div class="line">    {</div>
<div class="line">      std::cout &lt;&lt; <span class="stringliteral">&quot;Ex1: Service of type &quot;</span> &lt;&lt; objectClass &lt;&lt; <span class="stringliteral">&quot; registered.&quot;</span> &lt;&lt; std::endl;</div>
<div class="line">    }</div>
<div class="line">    <span class="keywordflow">else</span> <span class="keywordflow">if</span> (event.<a class="code" href="classServiceEvent.html#a5aa8635186e778407c75dbbd3b0a5fc8">GetType</a>() == <a class="code" href="group__MicroServices.html#ggae7426fe742bd938523b64d43c232a49fa2727d97ff0e689285e6364afe42ecf81">ServiceEvent::UNREGISTERING</a>)</div>
<div class="line">    {</div>
<div class="line">      std::cout &lt;&lt; <span class="stringliteral">&quot;Ex1: Service of type &quot;</span> &lt;&lt; objectClass &lt;&lt; <span class="stringliteral">&quot; unregistered.&quot;</span> &lt;&lt; std::endl;</div>
<div class="line">    }</div>
<div class="line">    <span class="keywordflow">else</span> <span class="keywordflow">if</span> (event.<a class="code" href="classServiceEvent.html#a5aa8635186e778407c75dbbd3b0a5fc8">GetType</a>() == <a class="code" href="group__MicroServices.html#ggae7426fe742bd938523b64d43c232a49fa25995ae997a4ee33c892e430a1fd2ca4">ServiceEvent::MODIFIED</a>)</div>
<div class="line">    {</div>
<div class="line">      std::cout &lt;&lt; <span class="stringliteral">&quot;Ex1: Service of type &quot;</span> &lt;&lt; objectClass &lt;&lt; <span class="stringliteral">&quot; modified.&quot;</span> &lt;&lt; std::endl;</div>
<div class="line">    }</div>
<div class="line">  }</div>
<div class="line">};</div>
<div class="line"></div>
<div class="line">}</div>
<div class="line"></div>
<div class="line"><a class="code" href="group__MicroServices.html#ga932a21356962fd94885680e1cc7a388c">US_EXPORT_MODULE_ACTIVATOR</a>(Activator)</div>
</div><!-- fragment --><p> After implementing the C++ source code for the module activator, we must <em>export</em> the activator such that the C++ Micro Services library can create an instance of it and call the <code>Load()</code> and <code>Unload()</code> methods:</p>
 <div class="fragment"><div class="line"><a name="l00001"></a><span class="lineno">    1</span>&#160;US_EXPORT_MODULE_ACTIVATOR(Activator)</div>
</div><!-- fragment --></p>
<p>Now we need to compile the source code. This example uses CMake as the build system and the top-level CMakeLists.txt file could look like this:</p>
 <div class="fragment"><div class="line"><a name="l00001"></a><span class="lineno">    1</span>&#160;project(CoreExamples)</div>
<div class="line"><a name="l00002"></a><span class="lineno">    2</span>&#160;</div>
<div class="line"><a name="l00003"></a><span class="lineno">    3</span>&#160;cmake_minimum_required(VERSION 2.8)</div>
<div class="line"><a name="l00004"></a><span class="lineno">    4</span>&#160;</div>
<div class="line"><a name="l00005"></a><span class="lineno">    5</span>&#160;find_package(CppMicroServices NO_MODULE REQUIRED)</div>
<div class="line"><a name="l00006"></a><span class="lineno">    6</span>&#160;</div>
<div class="line"><a name="l00007"></a><span class="lineno">    7</span>&#160;include_directories(${CppMicroServices_INCLUDE_DIRS})</div>
<div class="line"><a name="l00008"></a><span class="lineno">    8</span>&#160;</div>
<div class="line"><a name="l00009"></a><span class="lineno">    9</span>&#160;#-----------------------------------------------------------------------------</div>
<div class="line"><a name="l00010"></a><span class="lineno">   10</span>&#160;# Set C/CXX flags</div>
<div class="line"><a name="l00011"></a><span class="lineno">   11</span>&#160;#-----------------------------------------------------------------------------</div>
<div class="line"><a name="l00012"></a><span class="lineno">   12</span>&#160;</div>
<div class="line"><a name="l00013"></a><span class="lineno">   13</span>&#160;if(${CMAKE_PROJECT_NAME} STREQUAL ${PROJECT_NAME})</div>
<div class="line"><a name="l00014"></a><span class="lineno">   14</span>&#160;  set(CMAKE_CXX_FLAGS &quot;${CMAKE_CXX_FLAGS} ${US_CXX_FLAGS}&quot;)</div>
<div class="line"><a name="l00015"></a><span class="lineno">   15</span>&#160;  set(CMAKE_CXX_FLAGS_RELEASE &quot;${CMAKE_CXX_FLAGS_RELEASE} ${US_CXX_FLAGS_RELEASE}&quot;)</div>
<div class="line"><a name="l00016"></a><span class="lineno">   16</span>&#160;  set(CMAKE_CXX_FLAGS_DEBUG &quot;${CMAKE_CXX_FLAGS_DEBUG} ${US_CXX_FLAGS_DEBUG}&quot;)</div>
<div class="line"><a name="l00017"></a><span class="lineno">   17</span>&#160;  set(CMAKE_C_FLAGS &quot;${CMAKE_C_FLAGS} ${US_C_FLAGS}&quot;)</div>
<div class="line"><a name="l00018"></a><span class="lineno">   18</span>&#160;  set(CMAKE_C_FLAGS_RELEASE &quot;${CMAKE_C_FLAGS_RELEASE} ${US_C_FLAGS_RELEASE}&quot;)</div>
<div class="line"><a name="l00019"></a><span class="lineno">   19</span>&#160;  set(CMAKE_C_FLAGS_DEBUG &quot;${CMAKE_C_FLAGS_DEBUG} ${US_C_FLAGS_DEBUG}&quot;)</div>
<div class="line"><a name="l00020"></a><span class="lineno">   20</span>&#160;endif()</div>
<div class="line"><a name="l00021"></a><span class="lineno">   21</span>&#160;</div>
<div class="line"><a name="l00022"></a><span class="lineno">   22</span>&#160;#-----------------------------------------------------------------------------</div>
<div class="line"><a name="l00023"></a><span class="lineno">   23</span>&#160;# Init output directories</div>
<div class="line"><a name="l00024"></a><span class="lineno">   24</span>&#160;#-----------------------------------------------------------------------------</div>
<div class="line"><a name="l00025"></a><span class="lineno">   25</span>&#160;</div>
<div class="line"><a name="l00026"></a><span class="lineno">   26</span>&#160;set(CoreExamples_ARCHIVE_OUTPUT_DIRECTORY &quot;${PROJECT_BINARY_DIR}/lib&quot;)</div>
<div class="line"><a name="l00027"></a><span class="lineno">   27</span>&#160;set(CoreExamples_LIBRARY_OUTPUT_DIRECTORY &quot;${PROJECT_BINARY_DIR}/lib&quot;)</div>
<div class="line"><a name="l00028"></a><span class="lineno">   28</span>&#160;set(CoreExamples_RUNTIME_OUTPUT_DIRECTORY &quot;${PROJECT_BINARY_DIR}/bin&quot;)</div>
<div class="line"><a name="l00029"></a><span class="lineno">   29</span>&#160;</div>
<div class="line"><a name="l00030"></a><span class="lineno">   30</span>&#160;foreach(_type ARCHIVE LIBRARY RUNTIME)</div>
<div class="line"><a name="l00031"></a><span class="lineno">   31</span>&#160;  if(NOT CMAKE_${_type}_OUTPUT_DIRECTORY)</div>
<div class="line"><a name="l00032"></a><span class="lineno">   32</span>&#160;    set(CMAKE_${_type}_OUTPUT_DIRECTORY ${CoreExamples_${_type}_OUTPUT_DIRECTORY})</div>
<div class="line"><a name="l00033"></a><span class="lineno">   33</span>&#160;  endif()</div>
<div class="line"><a name="l00034"></a><span class="lineno">   34</span>&#160;endforeach()</div>
<div class="line"><a name="l00035"></a><span class="lineno">   35</span>&#160;</div>
<div class="line"><a name="l00036"></a><span class="lineno">   36</span>&#160;</div>
<div class="line"><a name="l00037"></a><span class="lineno">   37</span>&#160;function(CreateExample _name)</div>
<div class="line"><a name="l00038"></a><span class="lineno">   38</span>&#160;  set(_srcs ${ARGN})</div>
<div class="line"><a name="l00039"></a><span class="lineno">   39</span>&#160;</div>
<div class="line"><a name="l00040"></a><span class="lineno">   40</span>&#160;  usFunctionGetResourceSource(TARGET Example-${_name} OUT _srcs)</div>
<div class="line"><a name="l00041"></a><span class="lineno">   41</span>&#160;  usFunctionGenerateModuleInit(_srcs)</div>
<div class="line"><a name="l00042"></a><span class="lineno">   42</span>&#160;  </div>
<div class="line"><a name="l00043"></a><span class="lineno">   43</span>&#160;  add_library(Example-${_name} ${_srcs})</div>
<div class="line"><a name="l00044"></a><span class="lineno">   44</span>&#160;  set_property(TARGET Example-${_name} APPEND PROPERTY COMPILE_DEFINITIONS US_MODULE_NAME=${_name})</div>
<div class="line"><a name="l00045"></a><span class="lineno">   45</span>&#160;</div>
<div class="line"><a name="l00046"></a><span class="lineno">   46</span>&#160;  if(${_name}_DEPENDS)</div>
<div class="line"><a name="l00047"></a><span class="lineno">   47</span>&#160;    foreach(_dep ${${_name}_DEPENDS})</div>
<div class="line"><a name="l00048"></a><span class="lineno">   48</span>&#160;      include_directories(${PROJECT_SOURCE_DIR}/${_dep})</div>
<div class="line"><a name="l00049"></a><span class="lineno">   49</span>&#160;      target_link_libraries(Example-${_name} Example-${_dep})</div>
<div class="line"><a name="l00050"></a><span class="lineno">   50</span>&#160;    endforeach()</div>
<div class="line"><a name="l00051"></a><span class="lineno">   51</span>&#160;  endif()</div>
<div class="line"><a name="l00052"></a><span class="lineno">   52</span>&#160;  target_link_libraries(Example-${_name} ${CppMicroServices_LIBRARIES})</div>
<div class="line"><a name="l00053"></a><span class="lineno">   53</span>&#160;  set_target_properties(Example-${_name} PROPERTIES</div>
<div class="line"><a name="l00054"></a><span class="lineno">   54</span>&#160;    LABELS Examples</div>
<div class="line"><a name="l00055"></a><span class="lineno">   55</span>&#160;    OUTPUT_NAME ${_name}</div>
<div class="line"><a name="l00056"></a><span class="lineno">   56</span>&#160;  )</div>
<div class="line"><a name="l00057"></a><span class="lineno">   57</span>&#160;  </div>
<div class="line"><a name="l00058"></a><span class="lineno">   58</span>&#160;  usFunctionAddResources(TARGET Example-${_name} MODULE_NAME ${_name} WORKING_DIRECTORY ${PROJECT_SOURCE_DIR}/${_name}/resources FILES manifest.json)</div>
<div class="line"><a name="l00059"></a><span class="lineno">   59</span>&#160;  usFunctionEmbedResources(TARGET Example-${_name})</div>
<div class="line"><a name="l00060"></a><span class="lineno">   60</span>&#160;  </div>
<div class="line"><a name="l00061"></a><span class="lineno">   61</span>&#160;endfunction()</div>
<div class="line"><a name="l00062"></a><span class="lineno">   62</span>&#160;</div>
<div class="line"><a name="l00063"></a><span class="lineno">   63</span>&#160;add_subdirectory(eventlistener)</div>
</div><!-- fragment --></p>
<p>and the CMakeLists.txt file in the eventlistener subdirectory is:</p>
<div class="fragment"><div class="line">set(_srcs Activator.cpp)</div>
<div class="line"></div>
<div class="line">CreateExample(eventlistener ${_srcs})</div>
</div><!-- fragment --><p>The call to <code><a class="el" href="group__MicroServicesCMake.html#ga9b72f7ba11ea53a3039893522d318168" title="Generate a source file which handles proper initialization of a module. ">usFunctionGenerateModuleInit</a></code> is necessary to integrate the shared library as a module within the C++ Micro Service library. If you are not using CMake, you have to place a macro call to <code><a class="el" href="group__MicroServices.html#gafef0ba0e204d81331653e0fae5dc48ec" title="Creates initialization code for a module. ">US_INITIALIZE_MODULE</a></code> yourself into the module's source code, e.g. in <code>Activator.cpp</code>. Have a look at the <a class="el" href="MicroServices_GettingStarted.html">Getting Started</a> documentation for more details about using CMake or other build systems (e.g. Makefiles) when writing modules.</p>
<p>To run the examples contained in the C++ Micro Services library, we use a small driver program called <code>usCoreExamplesDriver</code>:</p>
<pre class="fragment">CppMicroServices-build&gt; bin/usCoreExamplesDriver
&gt; h
h               This help text
l &lt;id | name&gt;   Load the module with id &lt;id&gt; or name &lt;name&gt;
u &lt;id&gt;          Unload the module with id &lt;id&gt;
s               Print status information
q               Quit
&gt;
</pre><p>Typing <code>s</code> at the command prompt lists the available, loaded, and unloaded modules. To load the eventlistener module, type <code>l eventlistener</code> at the command prompt:</p>
<pre class="fragment">&gt; s
Id | Name                 | Status
-----------------------------------
 - | dictionaryclient     | -
 - | dictionaryclient2    | -
 - | dictionaryclient3    | -
 - | dictionaryservice    | -
 - | eventlistener        | -
 - | frenchdictionary     | -
 - | spellcheckclient     | -
 - | spellcheckservice    | -
 1 | CppMicroServices     | LOADED
&gt; l eventlistener
Starting to listen for service events.
&gt;
</pre><p>The above command loaded the eventlistener module (by loading its shared library). Keep in mind, that this module will not do much at this point since it only listens for service events and we are not registering any services. In the next example we will register a service that will generate an event for this module to receive. To exit the <code>usCoreExamplesDriver</code>, use the <code>q</code> command.</p>
<p>Next: <a class="el" href="MicroServices_Example2.html">Example 2 - Dictionary Service Module</a> </p>
</div></div><!-- contents -->

  <hr class="footer"/>
  <address class="footer"><small>Generated on Tue Oct 6 2015 for C++ Micro Services 2.99.0 by <a href="http://www.doxygen.org/index.html">Doxygen</a> 1.8.9.1
</small></address>
