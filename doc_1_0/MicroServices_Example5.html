---
layout: default
title: Example 5 - Service Tracker Dictionary Client Module
---
  <head>
    <title>C++ Micro Services: Example 5 - Service Tracker Dictionary Client Module</title>
    <link href="tabs.css" rel="stylesheet" type="text/css"/>
    <script type="text/javascript" src="jquery.js"></script>
    <script type="text/javascript" src="dynsections.js"></script>
    <link href="search/search.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="search/search.js"></script>
<script type="text/javascript">
  $(document).ready(function() { searchBox.OnSelectItem(0); });
</script>
    <link href="doxygen.css" rel="stylesheet" type="text/css" />
    <link href="doxygen_extra.css" rel="stylesheet" type="text/css"/>
  </head>
  <div id="top"><!-- do not remove this div, it is closed by doxygen! -->
<!-- Generated by Doxygen 1.8.3.1 -->
<script type="text/javascript">
var searchBox = new SearchBox("searchBox", "search",false,'Search');
</script>
  <div id="navrow1" class="tabs">
    <ul class="tablist">
      <li><a href="index.html"><span>Main&#160;Page</span></a></li>
      <li class="current"><a href="pages.html"><span>Related&#160;Pages</span></a></li>
      <li><a href="modules.html"><span>Modules</span></a></li>
      <li><a href="namespaces.html"><span>Namespaces</span></a></li>
      <li><a href="annotated.html"><span>Classes</span></a></li>
      <li>
        <div id="MSearchBox" class="MSearchBoxInactive">
        <span class="left">
          <img id="MSearchSelect" src="search/mag_sel.png"
               onmouseover="return searchBox.OnSearchSelectShow()"
               onmouseout="return searchBox.OnSearchSelectHide()"
               alt=""/>
          <input type="text" id="MSearchField" value="Search" accesskey="S"
               onfocus="searchBox.OnSearchFieldFocus(true)" 
               onblur="searchBox.OnSearchFieldFocus(false)" 
               onkeyup="searchBox.OnSearchFieldChange(event)"/>
          </span><span class="right">
            <a id="MSearchClose" href="javascript:searchBox.CloseResultsWindow()"><img id="MSearchCloseImg" border="0" src="search/close.png" alt=""/></a>
          </span>
        </div>
      </li>
    </ul>
  </div>
<!-- window showing the filter options -->
<div id="MSearchSelectWindow"
     onmouseover="return searchBox.OnSearchSelectShow()"
     onmouseout="return searchBox.OnSearchSelectHide()"
     onkeydown="return searchBox.OnSearchSelectKey(event)">
<a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(0)"><span class="SelectionMark">&#160;</span>All</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(1)"><span class="SelectionMark">&#160;</span>Classes</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(2)"><span class="SelectionMark">&#160;</span>Namespaces</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(3)"><span class="SelectionMark">&#160;</span>Functions</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(4)"><span class="SelectionMark">&#160;</span>Variables</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(5)"><span class="SelectionMark">&#160;</span>Typedefs</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(6)"><span class="SelectionMark">&#160;</span>Enumerations</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(7)"><span class="SelectionMark">&#160;</span>Enumerator</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(8)"><span class="SelectionMark">&#160;</span>Friends</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(9)"><span class="SelectionMark">&#160;</span>Groups</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(10)"><span class="SelectionMark">&#160;</span>Pages</a></div>

<!-- iframe showing the search results (closed by default) -->
<div id="MSearchResultsWindow">
<iframe src="javascript:void(0)" frameborder="0" 
        name="MSearchResults" id="MSearchResults">
</iframe>
</div>

<div id="nav-path" class="navpath">
  <ul>
<li class="navelem"><a class="el" href="MicroServices_Tutorials.html">Tutorial</a></li>  </ul>
</div>
</div><!-- top -->
<div class="header">
  <div class="headertitle">
<div class="title">Example 5 - Service Tracker Dictionary Client <a class="el" href="classModule.html" title="Represents a CppMicroServices module.">Module</a> </div>  </div>
</div><!--header-->
<div class="contents">
<div class="textblock"><p>In <a class="el" href="MicroServices_Example4.html">Example 4</a>, we created a more robust client bundle for our dictionary service. Due to the complexity of dealing with dynamic service availability, even that client may not sufficiently address all situations. To deal with this complexity the C++ Micro Services library provides the <code><a class="el" href="classServiceTracker.html" title="The ServiceTracker class simplifies using services from the framework&#39;s service registry.">ServiceTracker</a></code> utility class. In this example we create a client for the dictionary service that uses the <code><a class="el" href="classServiceTracker.html" title="The ServiceTracker class simplifies using services from the framework&#39;s service registry.">ServiceTracker</a></code> class to monitor the dynamic availability of the dictionary service, resulting in an even more robust client.</p>
<p>The functionality of the new dictionary client is essentially the same as the one from Example 4. Our module uses its module context to create a <code><a class="el" href="classServiceTracker.html" title="The ServiceTracker class simplifies using services from the framework&#39;s service registry.">ServiceTracker</a></code> instance to track the dynamic availability of the dictionary service on our behalf. Our client uses the dictionary service returned by the <code><a class="el" href="classServiceTracker.html" title="The ServiceTracker class simplifies using services from the framework&#39;s service registry.">ServiceTracker</a></code>, which is selected based on a ranking algorithm defined by the C++ Micro Services library. The source code for our modules is as follows in a file called <code>dictionaryclient3/Activator.cpp</code>:</p>
<div class="fragment"><div class="line"><span class="preprocessor">#include &quot;IDictionaryService.h&quot;</span></div>
<div class="line"></div>
<div class="line"><span class="preprocessor">#include &lt;usModuleActivator.h&gt;</span></div>
<div class="line"><span class="preprocessor">#include &lt;usModuleContext.h&gt;</span></div>
<div class="line"><span class="preprocessor">#include &lt;usServiceTracker.h&gt;</span></div>
<div class="line"></div>
<div class="line"><span class="comment">// Replace that include with your own base class declaration</span></div>
<div class="line"><span class="preprocessor">#include US_BASECLASS_HEADER</span></div>
<div class="line"><span class="preprocessor"></span></div>
<div class="line">US_USE_NAMESPACE</div>
<div class="line"><span class="comment"></span></div>
<div class="line"><span class="comment">/**</span></div>
<div class="line"><span class="comment"> * This class implements a module activator that uses a dictionary</span></div>
<div class="line"><span class="comment"> * service to check for the proper spelling of a word by</span></div>
<div class="line"><span class="comment"> * checking for its existence in the dictionary. This module</span></div>
<div class="line"><span class="comment"> * uses a service tracker to dynamically monitor the availability</span></div>
<div class="line"><span class="comment"> * of a dictionary service, instead of providing a custom service</span></div>
<div class="line"><span class="comment"> * listener as in Example 4. The module uses the service returned</span></div>
<div class="line"><span class="comment"> * by the service tracker, which is selected based on a ranking</span></div>
<div class="line"><span class="comment"> * algorithm defined by the C++ Micro Services library.</span></div>
<div class="line"><span class="comment"> * Again, the calling thread of the Load() method is used to read</span></div>
<div class="line"><span class="comment"> * words from standard input, checking its existence in the dictionary.</span></div>
<div class="line"><span class="comment"> * You can stop checking words by entering an empty line, but</span></div>
<div class="line"><span class="comment"> * to start checking words again you must unload and then load</span></div>
<div class="line"><span class="comment"> * the module again.</span></div>
<div class="line"><span class="comment"> */</span></div>
<div class="line"><span class="keyword">class </span>US_ABI_LOCAL Activator : <span class="keyword">public</span> <a class="code" href="structModuleActivator.html" title="Customizes the starting and stopping of a CppMicroServices module.">ModuleActivator</a></div>
<div class="line">{</div>
<div class="line"></div>
<div class="line"><span class="keyword">public</span>:</div>
<div class="line"></div>
<div class="line">  Activator()</div>
<div class="line">   : m_context(NULL)</div>
<div class="line">   , m_tracker(NULL)</div>
<div class="line">  {}</div>
<div class="line"><span class="comment"></span></div>
<div class="line"><span class="comment">  /**</span></div>
<div class="line"><span class="comment">   * Implements ModuleActivator::Load(). Creates a service</span></div>
<div class="line"><span class="comment">   * tracker to monitor dictionary services and starts its &quot;word</span></div>
<div class="line"><span class="comment">   * checking loop&quot;. It will not be able to check any words until</span></div>
<div class="line"><span class="comment">   * the service tracker finds a dictionary service; any discovered</span></div>
<div class="line"><span class="comment">   * dictionary service will be automatically used by the client.</span></div>
<div class="line"><span class="comment">   * It reads words from standard input and checks for their</span></div>
<div class="line"><span class="comment">   * existence in the discovered dictionary.</span></div>
<div class="line"><span class="comment">   *</span></div>
<div class="line"><span class="comment">   * \note It is very bad practice to use the calling thread to perform a</span></div>
<div class="line"><span class="comment">   *       lengthy process like this; this is only done for the purpose of</span></div>
<div class="line"><span class="comment">   *       the tutorial.</span></div>
<div class="line"><span class="comment">   *</span></div>
<div class="line"><span class="comment">   * @param context the module context for this module.</span></div>
<div class="line"><span class="comment">   */</span></div>
<div class="line">  <span class="keywordtype">void</span> <a class="code" href="structModuleActivator.html#a1db3f85c15a814a5918eb22725229967" title="Called when this module is loaded.">Load</a>(<a class="code" href="classModuleContext.html" title="A module&#39;s execution context within the framework.">ModuleContext</a> *context)</div>
<div class="line">  {</div>
<div class="line">    m_context = context;</div>
<div class="line"></div>
<div class="line">    <span class="comment">// Create a service tracker to monitor dictionary services.</span></div>
<div class="line">    m_tracker = <span class="keyword">new</span> <a class="code" href="classServiceTracker.html" title="The ServiceTracker class simplifies using services from the framework&#39;s service registry.">ServiceTracker&lt;IDictionaryService*&gt;</a>(</div>
<div class="line">                  m_context, <a class="code" href="classLDAPFilter.html" title="An RFC 1960-based Filter.">LDAPFilter</a>(std::string(<span class="stringliteral">&quot;(&amp;(&quot;</span>) + <a class="code" href="namespaceServiceConstants.html#a0e099b4cc3cf6e80301486024950b262" title="Service property identifying all of the class names under which a service was registered in the frame...">ServiceConstants::OBJECTCLASS</a>() + <span class="stringliteral">&quot;=&quot;</span> +</div>
<div class="line">                                        us_service_interface_iid&lt;IDictionaryService*&gt;() + <span class="stringliteral">&quot;)&quot;</span> +</div>
<div class="line">                                        <span class="stringliteral">&quot;(Language=*))&quot;</span>)</div>
<div class="line">                  );</div>
<div class="line">    m_tracker-&gt;<a class="code" href="classServiceTracker.html#ab15bf598b9eb79379dc6f3538f5d401b" title="Open this ServiceTracker and begin tracking services.">Open</a>();</div>
<div class="line"></div>
<div class="line">    std::cout &lt;&lt; <span class="stringliteral">&quot;Enter a blank line to exit.&quot;</span> &lt;&lt; std::endl;</div>
<div class="line"></div>
<div class="line">    <span class="comment">// Loop endlessly until the user enters a blank line</span></div>
<div class="line">    <span class="keywordflow">while</span> (std::cin)</div>
<div class="line">    {</div>
<div class="line">      <span class="comment">// Ask the user to enter a word.</span></div>
<div class="line">      std::cout &lt;&lt; <span class="stringliteral">&quot;Enter word: &quot;</span>;</div>
<div class="line"></div>
<div class="line">      std::string word;</div>
<div class="line">      std::getline(std::cin, word);</div>
<div class="line"></div>
<div class="line">      <span class="comment">// Get the selected dictionary, if available.</span></div>
<div class="line">      IDictionaryService* dictionary = m_tracker-&gt;GetService();</div>
<div class="line"></div>
<div class="line">      <span class="comment">// If the user entered a blank line, then</span></div>
<div class="line">      <span class="comment">// exit the loop.</span></div>
<div class="line">      <span class="keywordflow">if</span> (word.empty())</div>
<div class="line">      {</div>
<div class="line">        <span class="keywordflow">break</span>;</div>
<div class="line">      }</div>
<div class="line">      <span class="comment">// If there is no dictionary, then say so.</span></div>
<div class="line">      <span class="keywordflow">else</span> <span class="keywordflow">if</span> (dictionary == NULL)</div>
<div class="line">      {</div>
<div class="line">        std::cout &lt;&lt; <span class="stringliteral">&quot;No dictionary available.&quot;</span> &lt;&lt; std::endl;</div>
<div class="line">      }</div>
<div class="line">      <span class="comment">// Otherwise print whether the word is correct or not.</span></div>
<div class="line">      <span class="keywordflow">else</span> <span class="keywordflow">if</span> (dictionary-&gt;CheckWord(word))</div>
<div class="line">      {</div>
<div class="line">        std::cout &lt;&lt; <span class="stringliteral">&quot;Correct.&quot;</span> &lt;&lt; std::endl;</div>
<div class="line">      }</div>
<div class="line">      <span class="keywordflow">else</span></div>
<div class="line">      {</div>
<div class="line">        std::cout &lt;&lt; <span class="stringliteral">&quot;Incorrect.&quot;</span> &lt;&lt; std::endl;</div>
<div class="line">      }</div>
<div class="line">    }</div>
<div class="line"></div>
<div class="line">    <span class="comment">// This automatically closes the tracker</span></div>
<div class="line">    <span class="keyword">delete</span> m_tracker;</div>
<div class="line">  }</div>
<div class="line"><span class="comment"></span></div>
<div class="line"><span class="comment">  /**</span></div>
<div class="line"><span class="comment">   * Implements ModuleActivator::Unload(). Does nothing since</span></div>
<div class="line"><span class="comment">   * the C++ Micro Services library will automatically unget any used services.</span></div>
<div class="line"><span class="comment">   * @param context the context for the module.</span></div>
<div class="line"><span class="comment">   */</span></div>
<div class="line">  <span class="keywordtype">void</span> <a class="code" href="structModuleActivator.html#a410a3f54b7cad990e8d670450677218c" title="Called when this module is unloaded.">Unload</a>(<a class="code" href="classModuleContext.html" title="A module&#39;s execution context within the framework.">ModuleContext</a>* <span class="comment">/*context*/</span>)</div>
<div class="line">  {</div>
<div class="line">  }</div>
<div class="line"></div>
<div class="line"><span class="keyword">private</span>:</div>
<div class="line"></div>
<div class="line">  <span class="comment">// Module context</span></div>
<div class="line">  <a class="code" href="classModuleContext.html" title="A module&#39;s execution context within the framework.">ModuleContext</a>* m_context;</div>
<div class="line"></div>
<div class="line">  <span class="comment">// The service tracker</span></div>
<div class="line">  <a class="code" href="classServiceTracker.html" title="The ServiceTracker class simplifies using services from the framework&#39;s service registry.">ServiceTracker&lt;IDictionaryService*&gt;</a>* m_tracker;</div>
<div class="line">};</div>
<div class="line"></div>
<div class="line"><a class="code" href="group__MicroServices.html#gac441a2e64f59a76a5f7e42de67e87cba" title="Export a module activator class.">US_EXPORT_MODULE_ACTIVATOR</a>(dictionaryclient3, Activator)</div>
</div><!-- fragment --><p> Since this client uses the <code><a class="el" href="classServiceTracker.html" title="The ServiceTracker class simplifies using services from the framework&#39;s service registry.">ServiceTracker</a></code> utility class, it will automatically monitor the dynamic availability of the dictionary service. Again, we must link our module to the <code>dictionaryservice</code> module:</p>
<div class="fragment"><div class="line"><span class="keyword">set</span>(_srcs Activator.cpp)</div>
<div class="line"></div>
<div class="line"><a class="code" href="group__MicroServicesCMake.html#ga9b72f7ba11ea53a3039893522d318168" title="Generate a source file which handles proper initialization of a module.">usFunctionGenerateModuleInit</a>(_srcs</div>
<div class="line">                             NAME <span class="stringliteral">&quot;Dictionary Client 3&quot;</span></div>
<div class="line">                             LIBRARY_NAME <span class="stringliteral">&quot;dictionaryclient3&quot;</span>)</div>
<div class="line"></div>
<div class="line"><span class="keyword">set</span>(dictionaryclient3_DEPENDS dictionaryservice)</div>
<div class="line">CreateExample(dictionaryclient3 ${_srcs})</div>
</div><!-- fragment --><p>After running the <code>CppMicroServicesExampleDriver</code> executable, and loading the event listener module, we can use the <code>l dictionaryclient3</code> command to load our robust dictionary client module:</p>
<pre class="fragment">CppMicroServices-debug&gt; bin/CppMicroServicesExampleDriver
&gt; l eventlistener
Starting to listen for service events.
&gt; l dictionaryclient3
Ex1: Service of type IDictionaryService/1.0 registered.
Enter a blank line to exit.
Enter word:
</pre><p>The above command loads the module and its dependencies (the <code>dictionaryservice</code> module) in a single step. When we load the module, it will use the main thread to prompt us for words. Enter one word at a time to check the words and enter a blank line to stop checking words. To reload the module, we must use the <code>s</code> command to get the module identifier number for the module and first use the <code>u &lt;id&gt;</code> command to unload the module, then the <code>l &lt;id&gt;</code> command to re-load it. To test the dictionary service, enter any of the words in the dictionary (e.g., "welcome", "to", "the", "micro", "services", "tutorial") or any word not in the dictionary.</p>
<p>Since this client monitors the dynamic availability of the dictionary service, it is robust in the face of sudden departures of the the dictionary service. Further, when a dictionary service arrives, it automatically gets the service if it needs it and continues to function. These capabilities are a little difficult to demonstrate since we are using a simple single-threaded approach, but in a multi-threaded or GUI-oriented application this robustness is very useful.</p>
<p>Next: <a class="el" href="MicroServices_Example6.html">Example 6 - Spell Checker Service Module</a></p>
<p>Previous: <a class="el" href="MicroServices_Example4.html">Example 4 - Robust Dictionary Client Module</a> </p>
</div></div><!-- contents -->

  <hr class="footer"/>
  <address class="footer"><small>Generated on Fri Jul 19 2013 for C++ Micro Services 1.0.0 by <a href="http://www.doxygen.org/index.html">Doxygen</a> 1.8.3.1
</small></address>
